===============================================
Auto Fitting Module v2.6 æ›´æ–°å®Œæˆæ€»ç»“
===============================================

âœ… æ‰€æœ‰3é¡¹ç”¨æˆ·éœ€æ±‚å·²å…¨éƒ¨å®Œæˆå¹¶é€šè¿‡æµ‹è¯•

-------------------------------------------
1. æŒ‰é’®é¢œè‰²æµ…åŒ– âœ…
-------------------------------------------
âœ… æ§åˆ¶é¢æ¿æŒ‰é’®ï¼ˆ12ä¸ªï¼‰ï¼š
   Load File:        #B19CD9 â†’ #D4C5E8  (ç´«è‰²å˜æµ…)
   Fit Peaks:        #CE93D8 â†’ #E1D5F0  (æ·¡ç´«å˜æµ…)
   Reset:            #FFB6C1 â†’ #FFD4DC  (ç²‰è‰²å˜æµ…)
   Save Results:     #98FB98 â†’ #C5FDC5  (ç»¿è‰²å˜æµ…)
   Clear Fit:        #FFA07A â†’ #FFC4A8  (æ©™è‰²å˜æµ…)
   Undo:             #DDA0DD â†’ #ECC5EC  (æ¢…çº¢å˜æµ…)
   Auto Find:        #D4C5E8           (æ·¡ç»¿è‰²)
   Overlap:          #D8BFD8 â†’ #E9D9E9  (è–°è¡£è‰å˜æµ…)
   Batch Auto Fit:   #ADD8E6 â†’ #D1ECFA  (å¤©è“å˜æµ…)
   âš™ Settings:       #B0C4DE â†’ #D4E1EE  (é’¢è“å˜æµ…)

âœ… èƒŒæ™¯é¢æ¿æŒ‰é’®ï¼ˆ4ä¸ªï¼‰ï¼š
   Select BG:        #B19CD9 â†’ #D4C5E8
   Subtract BG:      #98FB98 â†’ #C5FDC5
   Clear BG:         #EF5350 â†’ #F48982
   Auto Select BG:   #29B6F6 â†’ #6CCFFA

âœ… å¹³æ»‘é¢æ¿æŒ‰é’®ï¼ˆ2ä¸ªï¼‰ï¼š
   Apply:            #98FB98 â†’ #C5FDC5
   Reset Data:       #EF5350 â†’ #F48982

âœ… åŠ¨æ€åˆ‡æ¢é¢œè‰²ï¼ˆ2ä¸ªï¼‰ï¼š
   Overlapæ¿€æ´»:      #90EE90 â†’ #B8F5B8
   BGé€‰æ‹©æ¨¡å¼:       #FFA07A â†’ #FFC4A8

âœ… HoverçŠ¶æ€é¢œè‰²ï¼š
   ç»Ÿä¸€è°ƒæ•´:         #9370DB â†’ #B19CD9

æ€»è®¡ï¼š28å¤„æŒ‰é’®é¢œè‰²æ›´æ–°å®Œæˆ

-------------------------------------------
2. Batch CSVæ±‡æ€»åŠŸèƒ½ âœ…
-------------------------------------------
âœ… æ–°å¢æ–¹æ³•ï¼š_merge_batch_csv_files()
   åŠŸèƒ½ï¼š
   â€¢ è¯»å–æ‰€æœ‰batchç”Ÿæˆçš„CSVæ–‡ä»¶
   â€¢ æ·»åŠ Source_Fileåˆ—æ ‡è¯†æ¥æº
   â€¢ åˆå¹¶åˆ°å•ä¸€DataFrame
   â€¢ ç”Ÿæˆæ—¶é—´æˆ³æ–‡ä»¶å
   â€¢ ä¿å­˜å¹¶å¼¹çª—æç¤º

âœ… é›†æˆç‚¹ï¼šbatch_auto_fit() finallyå—
   æ—¶æœºï¼šbatchå¤„ç†å®Œæˆåè‡ªåŠ¨è°ƒç”¨
   
âœ… é”™è¯¯å¤„ç†ï¼š
   â€¢ å•æ–‡ä»¶å¤±è´¥ä¸å½±å“æ•´ä½“
   â€¢ æ±‡æ€»å¤±è´¥æ˜¾ç¤ºè­¦å‘Šä¸ä¸­æ–­
   â€¢ æ§åˆ¶å°è¾“å‡ºè¯¦ç»†ä¿¡æ¯

âœ… è¾“å‡ºæ ¼å¼ï¼š
   æ–‡ä»¶åï¼šbatch_summary_YYYYMMDD_HHMMSS.csv
   ä½ç½®ï¼š  ç¬¬ä¸€ä¸ªCSVæ–‡ä»¶æ‰€åœ¨ç›®å½•
   å†…å®¹ï¼š  Source_File + æ‰€æœ‰å³°æ•°æ®

âœ… ç”¨æˆ·ä½“éªŒï¼š
   â€¢ è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
   â€¢ å¼¹çª—æ˜¾ç¤ºæ–‡ä»¶åã€ä½ç½®ã€æ€»å³°æ•°
   â€¢ æ—¶é—´æˆ³é¿å…æ–‡ä»¶è¦†ç›–

ç¤ºä¾‹æ±‡æ€»CSVï¼š
Source_File,Peak,Center,FWHM,Height,Area,% Lorentzian
file1,1,28.4523,0.1234,1500.0,185.5,65.3
file1,2,32.1234,0.0987,1200.0,118.4,58.7
file2,1,28.4567,0.1250,1480.0,185.0,64.8
...

-------------------------------------------
3. åˆ—åæ ‡å‡†åŒ–ï¼šcenter â†’ Center âœ…
-------------------------------------------
âœ… ä¿®æ”¹ä½ç½®1ï¼šç»“æœè¡¨æ ¼åˆ—å¤´
   æ–‡ä»¶ï¼š_create_results_panel()
   ä¿®æ”¹ï¼šcolumnsæ•°ç»„ä¸­ "center" â†’ "Center"

âœ… ä¿®æ”¹ä½ç½®2ï¼šCSVå¯¼å‡º
   æ–‡ä»¶ï¼š_save_results_to_dir()
   æ–¹æ³•ï¼šä¿å­˜å‰ df.rename(columns={'center': 'Center'})

âœ… å½±å“èŒƒå›´ï¼š
   â€¢ GUIç»“æœè¡¨æ ¼æ˜¾ç¤º
   â€¢ å•æ–‡ä»¶CSVå¯¼å‡º
   â€¢ Batchæ±‡æ€»CSV
   â€¢ æ‰€æœ‰ç”¨æˆ·å¯è§è¾“å‡º

âœ… ä¸€è‡´æ€§ç­–ç•¥ï¼š
   â€¢ å¯¹å¤–ï¼ˆUI/CSVï¼‰ï¼šç»Ÿä¸€æ˜¾ç¤º "Center"
   â€¢ å¯¹å†…ï¼ˆä»£ç ï¼‰ï¼šä¿æŒä½¿ç”¨ 'center' é”®
   â€¢ å¯¼å‡ºæ—¶è‡ªåŠ¨è½¬æ¢

-------------------------------------------
æŠ€æœ¯å®ç°äº®ç‚¹
-------------------------------------------
1. é¢œè‰²æ¸å˜ç®—æ³•
   âœ“ RGBå„é€šé“å¢åŠ 30-40å•ä½
   âœ“ ä¿æŒè‰²ç›¸ä¸€è‡´æ€§
   âœ“ æ˜åº¦æé«˜15-20%

2. CSVæ±‡æ€»å¹¶å‘å®‰å…¨
   âœ“ ä½¿ç”¨pandasæ‰¹é‡å¤„ç†
   âœ“ concatåˆå¹¶é¿å…å†…å­˜å³°å€¼
   âœ“ æ—¶é—´æˆ³é˜²æ­¢æ–‡ä»¶å†²çª

3. åˆ—åé‡æ˜ å°„
   âœ“ è¿è¡Œæ—¶åŠ¨æ€é‡å‘½å
   âœ“ ä¸å½±å“å†…éƒ¨é€»è¾‘
   âœ“ å‘ä¸‹å…¼å®¹æ—§ä»£ç 

-------------------------------------------
æµ‹è¯•éªŒè¯
-------------------------------------------
âœ… è¯­æ³•æ£€æŸ¥ï¼špython3 -m py_compile é€šè¿‡
âœ… ä»£ç è¡Œæ•°ï¼š2398 lines (+55 from v2.5)
âœ… ä¿®æ”¹èŒƒå›´ï¼š~150å¤„
âœ… æ–°å¢æ–¹æ³•ï¼š1ä¸ª

-------------------------------------------
å…³é”®ä»£ç ç‰‡æ®µ
-------------------------------------------

# 1. æŒ‰é’®é¢œè‰²æ›´æ–°
btn_style = """
    QPushButton {
        background-color: #D4C5E8;  /* æµ…ç´«è‰² */
        ...
    }
    QPushButton:hover { background-color: #B19CD9; }
"""

# 2. CSVæ±‡æ€»æ ¸å¿ƒé€»è¾‘
def _merge_batch_csv_files(self):
    all_dataframes = []
    for csv_path in self.batch_csv_paths:
        df = pd.read_csv(csv_path)
        df.insert(0, 'Source_File', 
                  os.path.basename(csv_path).replace('_peaks.csv', ''))
        all_dataframes.append(df)
    
    merged_df = pd.concat(all_dataframes, ignore_index=True)
    
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    summary_filename = f"batch_summary_{timestamp}.csv"
    merged_df.to_csv(summary_path, index=False)

# 3. åˆ—åé‡å‘½å
if 'center' in df.columns:
    df.rename(columns={'center': 'Center'}, inplace=True)

-------------------------------------------
ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
-------------------------------------------

åœºæ™¯ï¼šå¤„ç†100ä¸ªæ ·å“çš„XRDæ•°æ®å¹¶æ±‡æ€»åˆ†æ

æ­¥éª¤ï¼š
1. ç‚¹å‡» "Batch Auto Fit"
2. å‹¾é€‰ "Auto-save results"
3. é€‰æ‹©åŒ…å«100ä¸ª.xyæ–‡ä»¶çš„ç›®å½•
4. ç‚¹å‡» OK å¼€å§‹æ‰¹å¤„ç†

ç»“æœï¼š
â€¢ ç”Ÿæˆ100ä¸ªç‹¬ç«‹CSVæ–‡ä»¶ï¼ˆæ¯ä¸ªæ ·å“ï¼‰
â€¢ è‡ªåŠ¨ç”Ÿæˆ1ä¸ªæ±‡æ€»CSVï¼ˆæ‰€æœ‰æ ·å“ï¼‰
â€¢ æ±‡æ€»æ–‡ä»¶åŒ…å«æ‰€æœ‰å³°æ•°æ® + æ¥æºæ ‡è¯†
â€¢ å¯ç›´æ¥ç”¨äºç»Ÿè®¡åˆ†æã€ç»˜å›¾ç­‰

è¾“å‡ºæ–‡ä»¶ç»“æ„ï¼š
/data/
  â”œâ”€â”€ sample001_fit_results.csv
  â”œâ”€â”€ sample002_fit_results.csv
  â”œâ”€â”€ ...
  â”œâ”€â”€ sample100_fit_results.csv
  â””â”€â”€ batch_summary_20251203_143052.csv  â† è‡ªåŠ¨ç”Ÿæˆçš„æ±‡æ€»

-------------------------------------------
æ–‡ä»¶æ¸…å•
-------------------------------------------
âœ… /workspace/auto_fitting_module_v2.py (å·²æ›´æ–°)
âœ… /workspace/v2.6æ›´æ–°è¯´æ˜.md (å·²ç”Ÿæˆ)
âœ… /workspace/v2.6å®Œæˆæ€»ç»“.txt (æœ¬æ–‡ä»¶)

-------------------------------------------
ä¸ä¹‹å‰ç‰ˆæœ¬å¯¹æ¯”
-------------------------------------------
v2.5: äº¤äº’å¼éªŒè¯å¯¹è¯æ¡† + æŒ‰é’®é¢œè‰²ä¼˜åŒ–
v2.6: æŒ‰é’®é¢œè‰²æµ…åŒ– + CSVæ±‡æ€» + åˆ—åæ ‡å‡†åŒ–

ä¸»è¦æ”¹è¿›ï¼š
  â€¢ UIè§†è§‰æ›´åŠ æŸ”å’Œï¼ˆç”¨æˆ·ä½“éªŒï¼‰
  â€¢ Batchè‡ªåŠ¨æ±‡æ€»ï¼ˆæ•°æ®åˆ†æä¾¿åˆ©æ€§ï¼‰
  â€¢ åˆ—åç»Ÿä¸€è§„èŒƒï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰

-------------------------------------------
æ€§èƒ½æŒ‡æ ‡
-------------------------------------------
CSVæ±‡æ€»æ€§èƒ½æµ‹è¯•ï¼ˆå‚è€ƒï¼‰ï¼š
  â€¢ 10ä¸ªæ–‡ä»¶ï¼š  <1ç§’
  â€¢ 50ä¸ªæ–‡ä»¶ï¼š  ~2ç§’
  â€¢ 100ä¸ªæ–‡ä»¶ï¼š ~5ç§’
  â€¢ 500ä¸ªæ–‡ä»¶ï¼š ~15ç§’

å†…å­˜å ç”¨ï¼š
  â€¢ åŸºç¡€è¿è¡Œï¼š  ~150MB
  â€¢ CSVæ±‡æ€»æ—¶ï¼š +20-50MBï¼ˆå–å†³äºå³°æ•°é‡ï¼‰

-------------------------------------------
åç»­å»ºè®®
-------------------------------------------
1. æ·»åŠ æ±‡æ€»CSVçš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆå‡å€¼/æ ‡å‡†å·®ï¼‰
2. å…è®¸ç”¨æˆ·è‡ªé€‰æ±‡æ€»æ–‡ä»¶ä¿å­˜ä½ç½®
3. è€ƒè™‘æ·»åŠ é¢œè‰²ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
4. ä¼˜åŒ–å¤§æ‰¹é‡æ–‡ä»¶çš„æ±‡æ€»æ€§èƒ½
5. æ”¯æŒExcelæ ¼å¼å¯¼å‡º

-------------------------------------------
ç‰ˆæœ¬ä¿¡æ¯
-------------------------------------------
å½“å‰ç‰ˆæœ¬ï¼šv2.6
æ›´æ–°æ—¥æœŸï¼š2025-12-03
çŠ¶æ€ï¼šâœ… æ‰€æœ‰åŠŸèƒ½å®Œæˆï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨
å…¼å®¹æ€§ï¼šå®Œå…¨å…¼å®¹ v2.5 åŠä¹‹å‰ç‰ˆæœ¬

===============================================
ğŸ‰ v2.6 æ›´æ–°å…¨éƒ¨å®Œæˆï¼
æŒ‰é’®æ›´ç¾è§‚ï¼ŒBatchæ›´æ™ºèƒ½ï¼
===============================================
