# Batch Fit Module - Quick Start Guide

## æ¦‚è¿°

**Batch Fit** æ˜¯ä» `curvefit` (interactive_fitting_gui.py) ä¸­æå–çš„æ‰¹å¤„ç†åŠŸèƒ½ï¼Œç°å·²ç‹¬ç«‹æˆä¸ºä¸€ä¸ªå®Œæ•´æ¨¡å—ã€‚

## æ–‡ä»¶æ¶æ„

```
batch_fitting_module.py (38è¡Œ)
  â””â”€â”€ BatchFittingDialog (from batch_fitting_dialog.py, 1348è¡Œ)
      â”œâ”€â”€ æ–‡ä»¶åˆ—è¡¨ç®¡ç†
      â”œâ”€â”€ äº¤äº’å¼å³°é€‰æ‹©
      â”œâ”€â”€ Overlapå¯¹æ¯”æ¨¡å¼
      â”œâ”€â”€ è‡ªåŠ¨æ‰¹é‡æ‹Ÿåˆ
      â””â”€â”€ CSVç»“æœå¯¼å‡º
```

## å¯åŠ¨æ–¹å¼

1. è¿è¡Œ `python main.py`
2. ç‚¹å‡»ä¾§è¾¹æ  **"ğŸ“Š Batch Fit"** æŒ‰é’®
3. æ‰¹å¤„ç†ç•Œé¢ç›´æ¥æ˜¾ç¤ºï¼ˆæ— éœ€å¼¹çª—ï¼‰

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ–‡ä»¶ç®¡ç†
- ğŸ“ åŠ è½½æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰.xyæ–‡ä»¶
- ç‚¹å‡»æ–‡ä»¶åˆ—è¡¨å¿«é€Ÿåˆ‡æ¢
- å‰åå¯¼èˆªæŒ‰é’®

### 2. äº¤äº’å¼ç¼–è¾‘
- **å·¦é”®ç‚¹å‡»**ï¼šæ·»åŠ å³°/èƒŒæ™¯ç‚¹
- **å³é”®ç‚¹å‡»**ï¼šåˆ é™¤å³°/èƒŒæ™¯ç‚¹
- **è‡ªåŠ¨æ£€æµ‹**ï¼šæ™ºèƒ½è¯†åˆ«å³°ä½ç½®
- **æ¨¡å¼åˆ‡æ¢**ï¼šğŸ”´ Peak / ğŸ”µ Background

### 3. æ‰¹é‡æ‹Ÿåˆ
- **Fit Current** (Spaceé”®)ï¼šæ‹Ÿåˆå½“å‰æ–‡ä»¶
- **Auto Fit** (Enteré”®)ï¼šè‡ªåŠ¨æ‰¹é‡å¤„ç†æ‰€æœ‰æ–‡ä»¶
- **RÂ²è´¨é‡æ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æµ‹æ‹Ÿåˆè´¨é‡ï¼Œä½äºé˜ˆå€¼æ—¶æš‚åœ

### 4. Overlapæ¨¡å¼ (é«˜çº§åŠŸèƒ½)
- åŒæ—¶æ˜¾ç¤ºå¤šä¸ªæ–‡ä»¶
- è§†è§‰å¯¹æ¯”å³°ä½ç§»åŠ¨
- æ‰¹é‡æ‹Ÿåˆoverlappedæ–‡ä»¶
- é€‚åˆç³»åˆ—æ ·å“åˆ†æ

### 5. æ‹Ÿåˆå‡½æ•°æ”¯æŒ
- **Pseudo-Voigt**ï¼šæ··åˆLorentzianå’ŒGaussian
- **Voigt**ï¼šçœŸå®Voigt profile

### 6. ç»“æœä¿å­˜
- è‡ªåŠ¨ä¿å­˜åˆ° `fit_output/batch_fitting_results.csv`
- æ ¼å¼ï¼šFile, Peak, Center, FWHM, Area, Intensity, R_squared
- æ–‡ä»¶é—´ç©ºè¡Œåˆ†éš”

## å¿«æ·é”®

| æŒ‰é”® | åŠŸèƒ½ |
|------|------|
| **Enter** | å¼€å§‹è‡ªåŠ¨æ‰¹é‡æ‹Ÿåˆ |
| **Space** | æ‹Ÿåˆå½“å‰æ–‡ä»¶ |
| **â†** / **â†’** | ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªæ–‡ä»¶ |
| **A** | è‡ªåŠ¨æ£€æµ‹å³° |
| **C** | æ¸…é™¤æ‰€æœ‰æ ‡è®° |
| **P** | åˆ‡æ¢åˆ°å³°æ¨¡å¼ |
| **B** | åˆ‡æ¢åˆ°èƒŒæ™¯æ¨¡å¼ |
| **R** | é‡ç½®ç¼©æ”¾ |
| **O** | Toggle Overlapæ¨¡å¼ |

## ä½¿ç”¨æµç¨‹

### åŸºç¡€æ‰¹å¤„ç†
1. ç‚¹å‡» "ğŸ“ Load Folder" åŠ è½½æ–‡ä»¶å¤¹
2. è‡ªåŠ¨æ£€æµ‹å³°ä¼šé¢„å…ˆæ ‡è®°
3. æ‰‹åŠ¨è°ƒæ•´ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„å³°ï¼ˆå¦‚éœ€è¦ï¼‰
4. æŒ‰ **Enter** æˆ–ç‚¹å‡» "âš¡ Auto Fit"
5. ç­‰å¾…è‡ªåŠ¨å¤„ç†å®Œæˆ
6. ç‚¹å‡» "ğŸ’¾ Save All Results"

### Overlapå¯¹æ¯”åˆ†æ
1. åŠ è½½æ–‡ä»¶å¤¹ï¼Œè°ƒæ•´ç¬¬ä¸€ä¸ªæ–‡ä»¶
2. æŒ‰ **O** é”®æˆ–ç‚¹å‡» "ğŸ“Š Overlap"
3. åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼ˆå‰ä¸€ä¸ªä¿ç•™åœ¨èƒŒæ™¯ï¼‰
4. ç»§ç»­åˆ‡æ¢ï¼Œæ·»åŠ æ›´å¤šæ–‡ä»¶
5. è§†è§‰å¯¹æ¯”å³°çš„ä½ç½®
6. æŒ‰ **Enter** æ‹Ÿåˆæ‰€æœ‰overlappedæ–‡ä»¶
7. ä¿å­˜ç»“æœ

## ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Batch Peak Fitting - Interactive Mode                    â”‚
â”‚                                         ğŸ“ Load Folder       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ğŸ“„ File  â”‚  Add Mode: [ğŸ”´ Peak] [ğŸ”µ Background]             â”‚
â”‚ List    â”‚  Fit Method: [Pseudo-Voigt â–¼]                     â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚file1.xy â”‚  [ğŸ”Auto Detect] [ğŸ—‘ï¸Clear All] [ğŸ”Reset Zoom]   â”‚
â”‚file2.xy â”‚  [âœ¨Fit Current] [âš¡Auto Fit] [ğŸ“ŠOverlap]        â”‚
â”‚file3.xy â”‚  ğŸ’¡ Left:Add | Right:Delete | Scroll:Zoom        â”‚
â”‚  ...    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”‚              [XRDæ•°æ®ç»˜å›¾åŒºåŸŸ]                     â”‚
â”‚         â”‚        å³°ã€èƒŒæ™¯ç‚¹ã€æ‹Ÿåˆæ›²çº¿å®æ—¶æ˜¾ç¤º               â”‚
â”‚         â”‚                                                    â”‚
â”‚Loaded   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚10 files â”‚  [1/10] file1.xy  [â¬…Previous] [Nextâ¡] [ğŸ’¾Save]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸ Auto Fit çš„å¯¹æ¯”

| ç‰¹æ€§ | Batch Fit (curvefit) | Auto Fit (v2.7) |
|------|---------------------|-----------------|
| **æ¥æº** | interactive_fitting_gui | auto_fitting_module_v2 |
| **ç•Œé¢** | å·¦å³åˆ†æ  | å•å±æ§åˆ¶é¢æ¿ |
| **æ–‡ä»¶åˆ‡æ¢** | ç‚¹å‡»åˆ—è¡¨å¿«é€Ÿè·³è½¬ | å‰åæŒ‰é’®é¡ºåºå¯¼èˆª |
| **Overlap** | âœ… æ”¯æŒå¤šæ–‡ä»¶å åŠ  | âŒ ä¸æ”¯æŒ |
| **æ‰¹å¤„ç†** | Auto Fitè‡ªåŠ¨è¿ç»­ | Verifyé€ä¸ªç¡®è®¤ |
| **é€‚åˆåœºæ™¯** | å¯¹æ¯”åˆ†æ | å¿«é€Ÿæ‰¹å¤„ç† |

**å»ºè®®ï¼š**
- éœ€è¦å¯¹æ¯”å³°ä½ç§»åŠ¨ â†’ ä½¿ç”¨ **Batch Fit**
- å¤§æ‰¹é‡å¿«é€Ÿå¤„ç† â†’ ä½¿ç”¨ **Auto Fit**

## æŠ€æœ¯ç»†èŠ‚

### åµŒå…¥æŠ€æœ¯
```python
# å°† QDialog æ”¹ä¸ºå¯åµŒå…¥çš„ QWidget
self.batch_dialog = BatchFittingDialog(parent=None)
self.batch_dialog.setWindowFlags(
    self.batch_dialog.windowFlags() & ~Qt.WindowType.Dialog
)
```

### æ‹Ÿåˆç®—æ³•
- **Voigt**: `wofz` (Faddeeva function)
- **Pseudo-Voigt**: Linear combination of Gaussian and Lorentzian
- **èƒŒæ™¯æ‰£é™¤**: å¤šç‚¹çº¿æ€§æ’å€¼
- **è´¨é‡è¯„ä¼°**: RÂ² (Coefficient of Determination)

### è¾“å‡ºæ ¼å¼
```csv
File,Peak,Center,FWHM,Area,Intensity,R_squared
sample1,Peak 1,29.453,0.123,1523.4,8234.2,0.985
sample1,Peak 2,31.234,0.145,1234.5,6543.1,0.972

sample2,Peak 1,29.456,0.121,1534.2,8245.3,0.988
sample2,Peak 2,31.237,0.143,1245.6,6554.2,0.975
```

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•æ¢å¤curvefitæ¨¡å—ï¼Ÿ**

A: åœ¨ `main.py` ä¸­å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼š
```python
# Line ~167-168
self.curvefit_btn = self.create_sidebar_button("ğŸ“ˆ  curvefit", ...)
sidebar_layout.addWidget(self.curvefit_btn)

# Line ~364
"curvefit": self.curvefit_btn,
```

**Q: Batch Fit å’Œ Auto Fit æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

A: 
- **Batch Fit**: æ¥è‡ªcurvefitï¼Œæ”¯æŒOverlapå¯¹æ¯”ï¼Œé€‚åˆç²¾ç»†åˆ†æ
- **Auto Fit**: v2.7æ–°æ¨¡å—ï¼Œæ”¯æŒéªŒè¯å¯¹è¯æ¡†ï¼Œé€‚åˆå¿«é€Ÿæ‰¹å¤„ç†

**Q: ä¸ºä»€ä¹ˆè¦ç‹¬ç«‹BatchåŠŸèƒ½ï¼Ÿ**

A: ç”¨æˆ·éœ€æ±‚æ˜¯æå–curvefitçš„batchåŠŸèƒ½ä½œä¸ºç‹¬ç«‹æ¨¡å—ï¼ŒåŒæ—¶éšè—å®Œæ•´çš„curvefitç•Œé¢ã€‚è¿™æ ·å¯ä»¥ï¼š
1. ç®€åŒ–ä¾§è¾¹æ 
2. çªå‡ºæ ¸å¿ƒæ‰¹å¤„ç†åŠŸèƒ½
3. ä¿æŒä¸¤ä¸ªbatchæ¨¡å—å„æœ‰ä¾§é‡

**Q: Overlapæ¨¡å¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ**

A: é€‚åˆå¯¹æ¯”ç³»åˆ—æ ·å“ï¼ˆå¦‚æ¸©åº¦åºåˆ—ã€æ—¶é—´åºåˆ—ï¼‰çš„å³°ä½ç§»åŠ¨ï¼š
1. åŒæ—¶æ˜¾ç¤ºå¤šä¸ªæ ·å“çš„XRDæ•°æ®
2. ç›´è§‚çœ‹åˆ°å³°çš„ä½ç½®å˜åŒ–
3. ä¸€æ¬¡æ€§æ‹Ÿåˆæ‰€æœ‰æ ·å“

## æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

- `.xy` (ä¸»è¦)
- `.dat`
- `.txt`
- ä¸¤åˆ—æ•°æ®ï¼š2Î¸ (deg) å’Œ Intensity

## ä¾èµ–åº“

```python
numpy          # æ•°æ®å¤„ç†
scipy          # æ‹Ÿåˆç®—æ³• (curve_fit, wofz)
pandas         # CSVè¾“å‡º
matplotlib     # ç»˜å›¾
PyQt6          # GUIæ¡†æ¶
```

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | è¡Œæ•° |
|------|------|------|
| `batch_fitting_module.py` | æ¨¡å—åŒ…è£…å™¨ | 38 |
| `batch_fitting_dialog.py` | æ ¸å¿ƒåŠŸèƒ½å®ç° | 1348 |
| `interactive_fitting_gui.py` | åŸcurvefit (å·²éšè—) | 2560 |
| `main.py` | ä¸»ç¨‹åº | ~800 |

## æ›´æ–°æ—¥å¿—

### v1.0 (2025-12-03)
- âœ… ä» curvefit æå– batch åŠŸèƒ½
- âœ… åˆ›å»ºç‹¬ç«‹ Batch Fit æ¨¡å—
- âœ… éšè— curvefit ä¾§è¾¹æ æŒ‰é’®
- âœ… å®Œæ•´ä¿ç•™æ‰€æœ‰åŠŸèƒ½
- âœ… æ”¯æŒåµŒå…¥å¼æ˜¾ç¤º
- âœ… ç¼–è¯‘æµ‹è¯•é€šè¿‡

## å¼€å‘è€…ä¿¡æ¯

**æ¨¡å—æ¥æº**: interactive_fitting_gui.py (curvefit)  
**æ ¸å¿ƒä»£ç **: batch_fitting_dialog.py (1348è¡Œ)  
**åŒ…è£…å™¨**: batch_fitting_module.py (38è¡Œ)  
**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2025-12-03  

---

**å¿«é€Ÿå¼€å§‹ï¼š**
```bash
python main.py
# ç‚¹å‡»ä¾§è¾¹æ  "ğŸ“Š Batch Fit"
# ç‚¹å‡» "ğŸ“ Load Folder"
# æŒ‰ Enter å¼€å§‹æ‰¹å¤„ç†
```

**æ–‡æ¡£ä½ç½®ï¼š**
- è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ï¼š`æ¨¡å—åˆ†ç¦»è¯´æ˜_æ­£ç¡®ç‰ˆ.md`
- å®Œæˆæ€»ç»“ï¼š`æ¨¡å—é‡ç»„å®Œæˆæ€»ç»“_æ­£ç¡®ç‰ˆ.txt`
