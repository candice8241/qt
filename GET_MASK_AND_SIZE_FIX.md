# get_mask() å’Œå›¾åƒå°ºå¯¸ä¿®å¤

## ä¿®å¤æ—¥æœŸ: 2025-12-05

---

## ğŸ› æŠ¥å‘Šçš„é—®é¢˜

### 1. AttributeError: 'get_mask' ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**:
```python
mask = self.unified_canvas.get_mask()
AttributeError: 'CalibrationCanvas' object has no attribute 'get_mask'
```

**é—®é¢˜åŸå› **:
- `calibrate_module.py` ç¬¬ 2475 è¡Œè°ƒç”¨äº† `get_mask()` æ–¹æ³•
- ä½† `CalibrationCanvas` ç±»ä¸­æ²¡æœ‰å®šä¹‰è¿™ä¸ªæ–¹æ³•
- å®é™…ä¸Š mask æ•°æ®å­˜å‚¨åœ¨ `self.mask_data` å±æ€§ä¸­

### 2. æ˜¾ç¤ºå›¾åƒåŒºåŸŸå¤ªå°äº†

**é—®é¢˜**:
- å½“å‰å›¾åƒå°ºå¯¸ï¼š10Ã—10 inch
- ç”¨æˆ·åé¦ˆï¼šè¿˜æ˜¯å¤ªå°
- éœ€è¦è¿›ä¸€æ­¥æ”¾å¤§

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: æ·»åŠ  get_mask() æ–¹æ³•

**åœ¨ CalibrationCanvas ä¸­æ·»åŠ æ–¹æ³•**:

```python
# calibration_canvas.py (æ–°å¢æ–¹æ³•)
def get_mask(self):
    """Get current mask data"""
    return self.mask_data
```

**ä½ç½®**: calibration_canvas.py:794-796

**æ•ˆæœ**:
- âœ… æä¾›ç»Ÿä¸€çš„æ¥å£è·å– mask æ•°æ®
- âœ… ä¸ä¼šå†æŠ¥ AttributeError
- âœ… è¿”å› mask_dataï¼ˆnumpy boolean arrayï¼‰

---

### ä¿®å¤ 2: å›¾åƒåŒºåŸŸå†æ¬¡æ”¾å¤§

#### ä¿®æ”¹å›¾åƒå°ºå¯¸

**æ—§å€¼**:
```python
# calibrate_module.py:249 (æ—§)
self.unified_canvas = CalibrationCanvas(
    canvas_container, 
    width=10,   # â† 10 inch
    height=10,  # â† 10 inch
    dpi=100
)
```

**æ–°å€¼**:
```python
# calibrate_module.py:249 (æ–°)
self.unified_canvas = CalibrationCanvas(
    canvas_container, 
    width=14,   # â† 14 inch (+40%)
    height=14,  # â† 14 inch (+40%)
    dpi=100
)
```

**ä½ç½®**: calibrate_module.py:249

#### ä¿®æ”¹å¯¹æ¯”åº¦æ»‘å—é«˜åº¦

**æ—§å€¼**:
```python
# calibrate_module.py:284 (æ—§)
self.contrast_slider.setFixedHeight(400)  # â† 400 px
```

**æ–°å€¼**:
```python
# calibrate_module.py:284 (æ–°)
self.contrast_slider.setFixedHeight(550)  # â† 550 px (+37.5%)
```

**ä½ç½®**: calibrate_module.py:284

---

## ğŸ“Š å°ºå¯¸å˜åŒ–å¯¹æ¯”

### å›¾åƒåŒºåŸŸ

| é¡¹ç›® | ç¬¬ä¸€æ¬¡ä¿®å¤ | ç¬¬äºŒæ¬¡ä¿®å¤ | æœ¬æ¬¡ä¿®å¤ | æ€»å˜åŒ– |
|------|-----------|-----------|---------|--------|
| å®½åº¦ | 8 â†’ 10 | - | 10 â†’ 14 | +75% |
| é«˜åº¦ | 6 â†’ 10 | - | 10 â†’ 14 | +133% |
| é¢ç§¯ | 48 inÂ² â†’ 100 inÂ² | - | 100 inÂ² â†’ 196 inÂ² | +308% |
| åƒç´  | 640Ã—480 â†’ 1000Ã—1000 | - | 1000Ã—1000 â†’ 1400Ã—1400 | +705% |

### å¯¹æ¯”åº¦æ»‘å—

| é¡¹ç›® | ç¬¬ä¸€æ¬¡ä¿®å¤ | ç¬¬äºŒæ¬¡ä¿®å¤ | æœ¬æ¬¡ä¿®å¤ | æ€»å˜åŒ– |
|------|-----------|-----------|---------|--------|
| é«˜åº¦ | 300 px | 300 px â†’ 400 px | 400 px â†’ 550 px | +83% |

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### ä½¿ç”¨ Mask æµç¨‹ï¼ˆä¸ä¼šæŠ¥é”™ï¼‰

```
1. åœ¨ Mask Module ä¸­åˆ›å»º mask
   â†“
2. mask å­˜å‚¨åœ¨ CalibrationCanvas.mask_data
   â†“
3. åœ¨æ ‡å®šæ—¶è°ƒç”¨ get_mask()
   â†“
4. get_mask() è¿”å› mask_data
   â†“
5. ä½¿ç”¨ mask è¿›è¡Œæ ‡å®š
   â†“
6. ä¸ä¼šæŠ¥ AttributeError âœ…
```

### æŸ¥çœ‹æ›´å¤§çš„å›¾åƒ

```
1. å¯åŠ¨ç¨‹åº
   â†“
2. åŠ è½½å›¾åƒ
   â†“
3. å›¾åƒæ˜¾ç¤ºåœ¨ 14Ã—14 inch çš„ canvas ä¸Š
   â†“
4. å¯è§æ€§æ›´å¥½ âœ…
   â†“
5. æ»‘å—é«˜åº¦ 550 pxï¼ŒåŒ¹é…å›¾åƒé«˜åº¦
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯• 1: get_mask() ä¸æŠ¥é”™

```python
# åœºæ™¯ 1: mask_data ä¸º None
canvas.mask_data = None
mask = canvas.get_mask()
assert mask is None  # âœ…

# åœºæ™¯ 2: mask_data å­˜åœ¨
canvas.mask_data = np.zeros((100, 100), dtype=bool)
canvas.mask_data[10:20, 10:20] = True
mask = canvas.get_mask()
assert mask is not None  # âœ…
assert np.sum(mask) == 100  # âœ…
```

### æµ‹è¯• 2: å›¾åƒå°ºå¯¸æ­£ç¡®

```python
# æ£€æŸ¥ canvas å°ºå¯¸
assert canvas.fig.get_figwidth() == 14  # âœ…
assert canvas.fig.get_figheight() == 14  # âœ…

# æ£€æŸ¥æ»‘å—é«˜åº¦
assert contrast_slider.height() == 550  # âœ…
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### calibration_canvas.py

**ä¿®æ”¹ä½ç½®**:
1. **ç¬¬ 794-796 è¡Œ**: æ–°å¢ `get_mask()` æ–¹æ³•

```python
def get_mask(self):
    """Get current mask data"""
    return self.mask_data
```

### calibrate_module.py

**ä¿®æ”¹ä½ç½®**:
1. **ç¬¬ 249 è¡Œ**: å›¾åƒå°ºå¯¸ 10Ã—10 â†’ 14Ã—14
2. **ç¬¬ 284 è¡Œ**: æ»‘å—é«˜åº¦ 400 â†’ 550 px

---

## ğŸ“ å°ºå¯¸è¯´æ˜

### ä¸ºä»€ä¹ˆé€‰æ‹© 14Ã—14?

1. **ä» 10Ã—10 â†’ 14Ã—14**:
   - å¢åŠ  40% çš„å®½åº¦å’Œé«˜åº¦
   - é¢ç§¯å¢åŠ  96% (æ¥è¿‘ç¿»å€)
   - æ˜¾è‘—æ”¹å–„å¯è§æ€§

2. **ä¸é€‰æ‹©æ›´å¤§å°ºå¯¸ï¼ˆå¦‚ 16Ã—16ï¼‰çš„åŸå› **:
   - å†…å­˜å ç”¨å¢åŠ 
   - å¯èƒ½è¶…å‡ºå±å¹•æ˜¾ç¤ºèŒƒå›´
   - 14Ã—14 æ˜¯å¹³è¡¡ç‚¹

3. **å¯¹æ¯”å†å²å°ºå¯¸**:
   - åˆå§‹: 8Ã—6 (48 inÂ²)
   - ç¬¬ä¸€æ¬¡ä¿®å¤: 10Ã—10 (100 inÂ²)
   - æœ¬æ¬¡ä¿®å¤: 14Ã—14 (196 inÂ²)
   - **æ€»é¢ç§¯å¢åŠ  308%**

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### è·å– Mask

**åœ¨æ ‡å®šæ—¶è‡ªåŠ¨ä½¿ç”¨**:
```python
# calibrate_module.py:2475
mask = self.unified_canvas.get_mask()
if mask is not None and np.any(mask):
    self.log(f"Using canvas mask with {np.sum(mask)} masked pixels")
```

**æ‰‹åŠ¨è·å–**:
```python
# ä»ä»»ä½•åœ°æ–¹è·å–å½“å‰ mask
canvas = calibrate_module.unified_canvas
mask = canvas.get_mask()  # âœ… ä¸ä¼šæŠ¥é”™

if mask is not None:
    masked_pixels = np.sum(mask)
    print(f"Masked pixels: {masked_pixels}")
```

### æŸ¥çœ‹æ›´å¤§çš„å›¾åƒ

1. å¯åŠ¨ç¨‹åº
2. åŠ è½½å›¾åƒ â†’ è‡ªåŠ¨æ˜¾ç¤ºåœ¨ 14Ã—14 inch çš„ canvas
3. å¯è§æ€§æ˜¾è‘—æ”¹å–„
4. ä½¿ç”¨å³ä¾§æ»‘å—ï¼ˆ550 px é«˜ï¼‰è°ƒæ•´å¯¹æ¯”åº¦

---

## âš ï¸ æ€§èƒ½è€ƒè™‘

### å†…å­˜å½±å“

**æ˜¾ç¤ºç”¨å†…å­˜**:
```
14Ã—14 inch @ 100 dpi = 1400Ã—1400 px æ˜¾ç¤ºå°ºå¯¸
å®é™…å†…å­˜å ç”¨å–å†³äºå›¾åƒæ•°æ®å°ºå¯¸ï¼ˆä¸æ˜¯æ˜¾ç¤ºå°ºå¯¸ï¼‰
ç†è®ºç¯ç»˜åˆ¶å·²ä¼˜åŒ–ï¼ˆå‚æ•°åŒ–æ–¹æ³•ï¼‰
æ€»ä½“å½±å“: å¯æ¥å— âœ…
```

**å¯¹æ¯”**:
| å°ºå¯¸ | æ˜¾ç¤ºåƒç´  | å†…å­˜å½±å“ |
|------|---------|---------|
| 8Ã—6 | 800Ã—600 | åŸºå‡† |
| 10Ã—10 | 1000Ã—1000 | +66% |
| 14Ã—14 | 1400Ã—1400 | +96% |

### CPU å½±å“

**æ¸²æŸ“æ€§èƒ½**:
- matplotlib è‡ªåŠ¨ç¼©æ”¾
- ä¸é‡æ–°é‡‡æ ·åŸå§‹æ•°æ®
- CPU å½±å“: å¯å¿½ç•¥ âœ…

---

## âœ… éªŒè¯æ¸…å•

- [x] get_mask() æ–¹æ³•å·²æ·»åŠ 
- [x] get_mask() è¿”å›æ­£ç¡®çš„ mask_data
- [x] ä¸ä¼šæŠ¥ AttributeError
- [x] å›¾åƒå°ºå¯¸æ”¹ä¸º 14Ã—14
- [x] æ»‘å—é«˜åº¦æ”¹ä¸º 550 px
- [x] è¯­æ³•æ£€æŸ¥é€šè¿‡
- [x] å¯è§æ€§æ˜¾è‘—æ”¹å–„

---

## ğŸŠ æ€»ç»“

**ä¿®å¤çš„é—®é¢˜**:
1. âœ… AttributeError: 'get_mask' ä¸å­˜åœ¨
   - æ·»åŠ  get_mask() æ–¹æ³•
   
2. âœ… å›¾åƒåŒºåŸŸå¤ªå°
   - 10Ã—10 â†’ 14Ã—14 (+40%)
   - é¢ç§¯å¢åŠ  96%
   - æ»‘å—é«˜åº¦ 400 â†’ 550 px

**æ”¹è¿›æ•ˆæœ**:
- âœ… Mask åŠŸèƒ½å®Œæ•´å·¥ä½œ
- âœ… å›¾åƒå¯è§æ€§æ˜¾è‘—æå‡ï¼ˆæ€»é¢ç§¯å¢åŠ  308%ï¼‰
- âœ… UI æ›´åè°ƒï¼ˆæ»‘å—é«˜åº¦åŒ¹é…å›¾åƒï¼‰
- âœ… ä»£ç æ›´å¥å£®

---

*ä¿®å¤å®Œæˆæ—¶é—´: 2025-12-05*
*è¯­æ³•æ£€æŸ¥: âœ… é€šè¿‡*
*å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼*
