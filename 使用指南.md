# 标定模块使用指南

## 🎯 功能说明

点击 **Calibrate** 按钮后，系统会自动从内环到外环逐圈寻峰，并实时显示青色圆圈！

---

## 📝 两种使用方法

### 方法 1：手动添加种子点 + Calibrate（推荐）

```
1. Load Image File → 加载标定图像

2. 设置参数
   - Calibrant: LaB6 / CeO2 等
   - Wavelength: 例如 0.4133 Å
   - Distance: 例如 500 mm
   - Pixel Size: 例如 172 μm

3. 点击 "📍 Manual Peak Selection"
   → 在图像上手动点击几个峰位
   → 显示红色标记（仅手动点）

4. 点击 "🎯 Run Calibration"
   → 系统自动逐环寻峰
   → 实时显示青色圆圈
   → 控制台显示进度

5. 查看结果 → 保存 PONI 文件
```

### 方法 2：纯自动 Calibrate

```
1. Load Image File → 加载标定图像

2. 设置参数（同上）

3. 直接点击 "🎯 Run Calibration"
   → 全自动寻峰（无需手动点击）
   → 逐环显示青色圆圈

4. 查看结果 → 保存 PONI 文件
```

---

## 🎨 视觉效果

### 手动峰值选择
- 🔴 **红色标记**：你手动点击的位置
- **无蓝点**：不再自动搜索同环峰位

### Calibrate 后逐环寻峰
```
控制台输出：
======================================================================
Ring 1: 156 control points detected
  → Ring 1: Displayed 156 points
Ring 2: 168 control points detected
  → Ring 2: Displayed 168 points
...
======================================================================

图像显示：
Ring 1 → 🔵🔵🔵 青色圆圈
Ring 2 → 🔵🔵🔵 青色圆圈
Ring 3 → 🔵🔵🔵 青色圆圈
...
完成！
```

---

## ⚙️ 参数建议

### LaB6 标定样品
```
Calibrant: LaB6
Wavelength: 0.4133 Å (12 keV)
Distance: 500-1000 mm（根据实际设置）
Pixel Size: 172 μm（Pilatus 探测器）
```

### CeO2 标定样品
```
Calibrant: CeO2
Wavelength: 0.4133 Å (12 keV)
Distance: 500-1000 mm
Pixel Size: 172 μm
```

---

## 💡 使用技巧

1. **高质量图像**：使用清晰、高对比度的标定图像
2. **调整对比度**：使用 Auto Contrast 或手动调整
3. **准确参数**：Distance 和 Pixel Size 要准确
4. **观察日志**：控制台有详细的进度信息
5. **多环标定**：至少 3-5 个环获得更好的结果

---

## 🐛 常见问题

### Q: 点击 Calibrate 后没有显示青色圆圈？
A: 
- 检查图像是否正确加载
- 调整对比度使环更清晰
- 检查参数是否设置正确

### Q: 检测到的环太少？
A:
- 使用 Auto Contrast 功能
- 提高图像质量
- 检查 Distance 参数是否合理

### Q: Kernel died 怎么办？
A:
- 图像太大（> 16 MP）：对图像进行 binning
- 关闭其他占用内存的程序
- 重启程序

### Q: 手动点击时为什么没有蓝点？
A:
- 这是正常的！手动模式只显示红色标记
- 蓝色圆圈只在点击 Calibrate 后出现

---

## 📊 性能参考

**典型案例**（2048×2048 图像）：
- 检测环数：8-10 个
- 总控制点：1000-1500 个
- 处理时间：10-20 秒
- 内存占用：< 2 GB

---

## ✅ 功能总结

| 功能 | 说明 |
|------|------|
| 手动峰值选择 | 点击添加红色标记 |
| Calibrate 逐环寻峰 | 自动从内环到外环搜索 |
| 实时显示 | 每一圈立即显示青色圆圈 |
| 稳定性 | 解决了 kernel died 问题 |

---

## 🎉 开始使用！

加载图像 → 设置参数 → 点击 Calibrate → 观察逐环显示 → 完成！

就这么简单！✨

---

**详细说明**: 查看 `修复说明_移除手动蓝点.md`
