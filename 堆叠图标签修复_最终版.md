# å †å å›¾æ ‡ç­¾ä½ç½®ä¿®å¤ - æœ€ç»ˆç‰ˆ

## é—®é¢˜æ ¹æº

ä¹‹å‰çš„ä¿®å¤æ–¹æ¡ˆä»ç„¶æœ‰é—®é¢˜ï¼

### é”™è¯¯çš„è®¡ç®—æ–¹å¼
```python
# ä¹‹å‰çš„ä»£ç ï¼ˆé”™è¯¯ï¼‰
peak_height = np.max(data[:, 1])
y_pos = y_offset + peak_height * 0.5
```

**é—®é¢˜**ï¼šå‡è®¾æ•°æ®ä»0å¼€å§‹ï¼Œä½†å®é™…ä¸Šè¡å°„æ•°æ®æœ‰baselineï¼

### ä¸¾ä¾‹è¯´æ˜

å‡è®¾æ›²çº¿æ•°æ®çš„å¼ºåº¦èŒƒå›´æ˜¯ `[100, 200]`ï¼ˆä¸æ˜¯ä»0å¼€å§‹ï¼‰ï¼š

```
é”™è¯¯è®¡ç®—ï¼š
  y_pos = y_offset + 200 * 0.5
        = y_offset + 100  â† é”™è¯¯ï¼

å®é™…æ›²çº¿ä½ç½®ï¼š
  æœ€å°å€¼: 100 + y_offset
  æœ€å¤§å€¼: 200 + y_offset
  ä¸­é—´å€¼: 150 + y_offset  â† æ­£ç¡®ä½ç½®ï¼

æ­£ç¡®è®¡ç®—ï¼š
  y_pos = y_offset + (100 + 200) / 2.0
        = y_offset + 150  â† æ­£ç¡®ï¼
```

## æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒç®—æ³•
```python
# è®¡ç®—æ›²çº¿çš„å®é™…å¼ºåº¦èŒƒå›´
min_intensity = np.min(data[:, 1])  # æœ€å°å¼ºåº¦
max_intensity = np.max(data[:, 1])  # æœ€å¤§å¼ºåº¦

# æ ‡ç­¾ä½ç½® = offset + å®é™…èŒƒå›´çš„ä¸­ç‚¹
y_pos = y_offset + (min_intensity + max_intensity) / 2.0
```

### æ•°å­¦åŸç†

å †å å›¾ä¸­ï¼Œç¬¬ i æ¡æ›²çº¿çš„ y åæ ‡æ˜¯ï¼š
```
y_curve_i = original_intensity + i * offset
```

æ›²çº¿çš„å®é™… y èŒƒå›´æ˜¯ï¼š
```
[min(original_intensity) + i*offset, max(original_intensity) + i*offset]
```

ä¸­ç‚¹ä½ç½®ï¼š
```
y_middle = i*offset + [min(original_intensity) + max(original_intensity)] / 2
```

è¿™å°±æ˜¯æ ‡ç­¾åº”è¯¥æ”¾ç½®çš„ä½ç½®ï¼

## ä¿®æ”¹å†…å®¹

### ä¿®æ”¹æ–‡ä»¶
1. **batch_integration.py**
   - `_create_single_pressure_stacked_plot()` - å•å‹åŠ›å¤šæ‰‡åŒºå †å å›¾
   - `_create_all_pressure_stacked_plot()` - å¤šå‹åŠ›ç‚¹å †å å›¾

2. **radial_module.py**
   - ç›¸åŒçš„ä¸¤ä¸ªå‡½æ•°

### ä»£ç å¯¹æ¯”

#### ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
```python
# é”™è¯¯ï¼šå‡è®¾æ•°æ®ä»0å¼€å§‹
peak_height = np.max(data[:, 1])
y_pos = y_offset + peak_height * 0.5

# å¦‚æœ data[:, 1] èŒƒå›´æ˜¯ [100, 200]
# y_pos = offset + 200 * 0.5 = offset + 100  â† ä¸åœ¨æ›²çº¿ä¸­é—´ï¼
```

#### ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
```python
# æ­£ç¡®ï¼šè€ƒè™‘å®é™…çš„minå’Œmax
min_intensity = np.min(data[:, 1])
max_intensity = np.max(data[:, 1])
y_pos = y_offset + (min_intensity + max_intensity) / 2.0

# å¦‚æœ data[:, 1] èŒƒå›´æ˜¯ [100, 200]
# y_pos = offset + (100 + 200) / 2 = offset + 150  â† æ­£å¥½åœ¨ä¸­é—´ï¼
```

## æ•ˆæœå¯¹æ¯”

### åœºæ™¯1: æ•°æ®æœ‰baseline

```
æ•°æ®èŒƒå›´: [100, 200]
offset = 1000

é”™è¯¯æ–¹å¼:
  æ›²çº¿èŒƒå›´: 1100 - 1200
  æ ‡ç­¾ä½ç½®: 1100  â† åœ¨åº•éƒ¨ï¼
  
æ­£ç¡®æ–¹å¼:
  æ›²çº¿èŒƒå›´: 1100 - 1200
  æ ‡ç­¾ä½ç½®: 1150  â† åœ¨ä¸­é—´ï¼âœ“
```

### åœºæ™¯2: ä¸åŒoffsetå€¼

```
æ•°æ®èŒƒå›´: [50, 150]
ä¸­ç‚¹: 100

offset = 500:
  æ›²çº¿èŒƒå›´: 550 - 650
  æ ‡ç­¾ä½ç½®: 600  â† æ­£ç¡®åœ¨ä¸­é—´

offset = 2000:
  æ›²çº¿èŒƒå›´: 2050 - 2150
  æ ‡ç­¾ä½ç½®: 2100  â† æ­£ç¡®åœ¨ä¸­é—´

offset = 5000:
  æ›²çº¿èŒƒå›´: 5050 - 5150
  æ ‡ç­¾ä½ç½®: 5100  â† æ­£ç¡®åœ¨ä¸­é—´
```

**ç»“è®º**ï¼šæ ‡ç­¾ä½ç½®å®Œå…¨éšoffsetå˜åŒ–ï¼Œå§‹ç»ˆåœ¨æ›²çº¿ä¸­é—´ï¼

## è§†è§‰æ•ˆæœ

### ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
```
å‹åŠ›30 GPa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† æ›²çº¿
     æ ‡ç­¾30 (åä¸‹ï¼Œä¸åœ¨ä¸­é—´)

å‹åŠ›20 GPa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† æ›²çº¿
     æ ‡ç­¾20 (åä¸‹ï¼Œä¸åœ¨ä¸­é—´)

å‹åŠ›10 GPa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† æ›²çº¿
     æ ‡ç­¾10 (åä¸‹ï¼Œä¸åœ¨ä¸­é—´)
```

### ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
```
å‹åŠ›30 GPa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† æ›²çº¿
       â”Œâ”€â”€â”€â”€â”€â”
       â”‚30GPaâ”‚ â† æ ‡ç­¾æ­£å¥½åœ¨ä¸­é—´ï¼
       â””â”€â”€â”€â”€â”€â”˜

å‹åŠ›20 GPa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† æ›²çº¿
       â”Œâ”€â”€â”€â”€â”€â”
       â”‚20GPaâ”‚ â† æ ‡ç­¾æ­£å¥½åœ¨ä¸­é—´ï¼
       â””â”€â”€â”€â”€â”€â”˜

å‹åŠ›10 GPa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† æ›²çº¿
       â”Œâ”€â”€â”€â”€â”€â”
       â”‚10GPaâ”‚ â† æ ‡ç­¾æ­£å¥½åœ¨ä¸­é—´ï¼
       â””â”€â”€â”€â”€â”€â”˜
```

## ä¸ºä»€ä¹ˆä¹‹å‰çš„æ–¹æ³•ä¸å¯¹ï¼Ÿ

### é—®é¢˜1: å‡è®¾baselineä¸º0
```python
peak_height = np.max(data[:, 1])  # åªå–æœ€å¤§å€¼
y_pos = y_offset + peak_height * 0.5  # ä»0åˆ°maxçš„ä¸­ç‚¹
```

**é”™è¯¯**ï¼šè¡å°„æ•°æ®é€šå¸¸æœ‰baselineï¼ˆèƒŒæ™¯å¼ºåº¦ï¼‰ï¼Œä¸æ˜¯ä»0å¼€å§‹ï¼

### é—®é¢˜2: å¿½ç•¥äº†æ•°æ®çš„å®é™…èŒƒå›´
XRDæ•°æ®ç‰¹ç‚¹ï¼š
- âœ… æœ‰èƒŒæ™¯å¼ºåº¦ï¼ˆbaselineï¼‰
- âœ… ä¸åŒæ•°æ®çš„baselineå¯èƒ½ä¸åŒ
- âœ… å³°å¼ºåº¦ç›¸å¯¹äºbaselineå˜åŒ–

æ­£ç¡®çš„åšæ³•æ˜¯æ‰¾åˆ°**å®é™…æ•°æ®çš„ä¸­ç‚¹**ï¼Œè€Œä¸æ˜¯å‡è®¾ä»0å¼€å§‹ã€‚

## éªŒè¯æ–¹æ³•

### æµ‹è¯•1: æ£€æŸ¥æ ‡ç­¾æ˜¯å¦åœ¨æ›²çº¿ä¸­é—´
```python
# è¯»å–ç”Ÿæˆçš„å †å å›¾
# å¯¹äºæ¯æ¡æ›²çº¿ï¼Œç›®æµ‹æ ‡ç­¾æ˜¯å¦åœ¨æ›²çº¿çš„å‚ç›´ä¸­é—´ä½ç½®
```

### æµ‹è¯•2: æ”¹å˜offsetå€¼
```python
# è®¾ç½® offset = 100
# ç”Ÿæˆå †å å›¾ï¼Œæ£€æŸ¥æ ‡ç­¾ä½ç½®

# è®¾ç½® offset = 5000  
# ç”Ÿæˆå †å å›¾ï¼Œæ£€æŸ¥æ ‡ç­¾ä½ç½®

# æ ‡ç­¾åº”è¯¥å§‹ç»ˆåœ¨å¯¹åº”æ›²çº¿çš„ä¸­é—´
```

### æµ‹è¯•3: ä¸åŒç±»å‹çš„æ•°æ®
- æœ‰æ˜æ˜¾peaksçš„æ•°æ®
- å¹³å¦çš„æ•°æ®
- å™ªå£°å¤§çš„æ•°æ®

æ‰€æœ‰æƒ…å†µä¸‹ï¼Œæ ‡ç­¾éƒ½åº”è¯¥åœ¨æ›²çº¿çš„å‚ç›´ä¸­é—´ã€‚

## ä»£ç æ³¨é‡Šè¯¦è§£

```python
# Add pressure label at the ACTUAL middle of the curve
# åœ¨æ›²çº¿çš„å®é™…ä¸­é—´ä½ç½®æ·»åŠ å‹åŠ›æ ‡ç­¾

# Curve's actual y range after offset: [min(data)+y_offset, max(data)+y_offset]
# æ›²çº¿åŠ ä¸Šoffsetåçš„å®é™…yèŒƒå›´ï¼š[æœ€å°å€¼+offset, æœ€å¤§å€¼+offset]

min_intensity = np.min(data[:, 1])  # åŸå§‹æ•°æ®çš„æœ€å°å¼ºåº¦
max_intensity = np.max(data[:, 1])  # åŸå§‹æ•°æ®çš„æœ€å¤§å¼ºåº¦

# Position label at the actual middle of the curve
# æ ‡ç­¾ä½ç½®ï¼šoffset + åŸå§‹æ•°æ®çš„ä¸­ç‚¹
y_pos = y_offset + (min_intensity + max_intensity) / 2.0
```

## æ€»ç»“

### å…³é”®æ”¹è¿›
âœ… **è€ƒè™‘äº†æ•°æ®baseline** - ä¸å‡è®¾æ•°æ®ä»0å¼€å§‹  
âœ… **ä½¿ç”¨å®é™…èŒƒå›´çš„ä¸­ç‚¹** - `(min + max) / 2`  
âœ… **å®Œå…¨éšoffsetç§»åŠ¨** - `y_offset + middle_point`  
âœ… **é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹** - æ— è®ºbaselineå¤šé«˜

### æ•°å­¦æ­£ç¡®æ€§
```
æ›²çº¿èŒƒå›´ï¼š[min + offset, max + offset]
ä¸­ç‚¹ä½ç½®ï¼š(min + offset + max + offset) / 2
        = offset + (min + max) / 2  â† æ­£ç¡®ï¼
```

### å®é™…æ•ˆæœ
- æ ‡ç­¾**å§‹ç»ˆåœ¨æ›²çº¿ä¸­é—´**
- æ ‡ç­¾**å®Œå…¨éšoffsetç§»åŠ¨**
- æ ‡ç­¾**ä¸ä¼šé”™ä½æˆ–é‡å **
- **é€‚ç”¨äºä»»ä½•offsetå€¼**

ç°åœ¨å †å å›¾çš„æ ‡ç­¾çœŸæ­£è§£å†³äº†å¯¹åº”é—®é¢˜ï¼ğŸ¯
