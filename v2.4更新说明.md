# Auto Fitting Module v2.4 更新说明

## 本次更新内容

根据用户反馈，完成以下4项修复和优化：

### 1. 修复 `info_text` 属性错误 ✅
**问题：** `'AutoFittingModule' object has no attribute 'info_text'`

**修复方案：**
- 将 `_create_info_panel` 改为只创建pass占位
- 新建 `_init_hidden_info_text()` 方法独立初始化隐藏的 `info_text` widget
- 在 `create_widgets()` 中确保 `_init_hidden_info_text()` 被调用
- `info_text` 设置为隐藏状态（`setVisible(False)`），保留 `update_info()` 日志功能

**修改文件：**
- `auto_fitting_module_v2.py` lines 684-690, 269-270

---

### 2. 统一禁用按钮颜色为 #F4F6FB ✅
**修改内容：**
将所有不能点击的按钮背景色从 `#CCCCCC` 改为 `#F4F6FB`

**修改位置：**
- `_create_control_panel()` - 主控制按钮样式 (line 296)
- `_create_background_panel()` - 背景处理按钮样式 (line 429)
- `_create_smoothing_panel()` - 平滑处理按钮样式 (line 567)

**样式更新：**
```python
QPushButton:disabled { 
    background-color: #F4F6FB;  # 从 #CCCCCC 改为 #F4F6FB
    color: #999999;  # 从 #666666 改为 #999999（更柔和）
}
```

---

### 3. 在图像下方添加页底分隔线 ✅
**新增内容：**
在绘图区域（canvas）下方添加一条水平分隔线，视觉上更好地标识页面底部

**实现方式：**
```python
# Add bottom border line
bottom_line = QFrame()
bottom_line.setFrameShape(QFrame.Shape.HLine)
bottom_line.setFrameShadow(QFrame.Shadow.Sunken)
bottom_line.setStyleSheet("QFrame { color: #CCCCCC; }")
plot_layout.addWidget(bottom_line)
```

**修改位置：**
- `_create_plot_area()` 方法，在 canvas 之后添加 (lines 680-684)

---

### 4. 全局字体增大1号 ✅
**修改内容：**
所有UI组件和图表字体统一增大1pt（从上一版本的基础上）

#### 4.1 控制面板 (`_create_control_panel`)
- 按钮字体：`7.5pt` → `8.5pt`
- 状态标签：`8.5pt` → `9.5pt`

#### 4.2 背景面板 (`_create_background_panel`)
- 标题标签：`7.5pt` → `8.5pt`
- 按钮字体：`6.5pt` → `7.5pt`
- 下拉框、输入框：`6.5pt` → `7.5pt`
- 坐标标签：`6.5pt` → `7.5pt`

#### 4.3 平滑面板 (`_create_smoothing_panel`)
- 标题标签：`7.5pt` → `8.5pt`
- 复选框：`6.5pt` → `7.5pt`
- 所有标签和输入框：`6.5pt` → `7.5pt`

#### 4.4 结果面板 (`_create_results_panel`)
- GroupBox标题：`7.5pt` → `8.5pt`
- 表格字体：`6.5pt` → `7.5pt`
- 表头字体：`6.5pt` → `7.5pt`

#### 4.5 绘图区域 (`_create_plot_area`)
- X轴标签：`fontsize=12` → `fontsize=13`
- Y轴标签：`fontsize=12` → `fontsize=13`
- 标题：`fontsize=10` → `fontsize=11`
- 刻度标签：`fontsize=10` → `fontsize=11`

#### 4.6 批处理对话框 (`show_batch_settings`)
- 所有QLabel：`8pt` → `9pt`
- 所有QDoubleSpinBox/QSpinBox：`8pt` → `9pt`
- 所有QCheckBox：`8pt` → `9pt`
- 所有QGroupBox：`8pt` → `9pt`
- 所有QRadioButton：`8pt` → `9pt`
- 所有QPushButton：`8pt` → `9pt`

#### 4.7 验证对话框 (`_show_verification_dialog`)
- 消息标签：`7.5pt` → `8.5pt`
- 所有按钮：`7.5pt` → `8.5pt`

#### 4.8 手动调整对话框 (`_show_manual_adjustment_dialog`)
- 所有标签：`8pt` → `9pt`
- 所有按钮：`8pt` → `9pt`

#### 4.9 所有绘图函数中的标题更新
- `load_file_by_path()`: 标题 `9pt` → `11pt`, 轴标签 `11pt` → `13pt`
- `subtract_background()`: 标题 `9pt` → `11pt`
- `reset_peaks()`: 标题 `9pt` → `11pt`
- `_extract_and_display_results()`: 标题 `9pt` → `11pt`
- `plot_data()`: 标题 `9pt` → `11pt`, 轴标签 `11pt` → `13pt`

---

## 测试验证

### 代码语法检查
```bash
python3 -m py_compile auto_fitting_module_v2.py
# ✅ 通过
```

### 功能验证项
1. ✅ 启动模块无 `info_text` 错误
2. ✅ 禁用按钮显示为 #F4F6FB 背景色
3. ✅ 图像下方显示分隔线
4. ✅ 所有UI组件字体增大1号
5. ✅ 绘图区域字体（标题、轴标签、刻度）增大1号

---

## 使用说明

### 更新模块
```bash
cd /workspace
# 确认 auto_fitting_module_v2.py 已更新
python3 main.py
```

### 测试清单
- [ ] 打开Auto Fitting模块，加载数据文件
- [ ] 验证无 `info_text` 报错
- [ ] 检查禁用按钮颜色是否为浅蓝色 (#F4F6FB)
- [ ] 确认图像下方有分隔线
- [ ] 检查所有UI文字是否清晰易读（字体增大1号）
- [ ] 检查图表标题、轴标签字体大小是否合适

---

## 技术细节

### 关键改动点
1. **info_text初始化分离**：避免依赖已移除的 `_create_info_panel` 显示逻辑
2. **QPushButton:disabled样式统一**：3处样式定义全部更新
3. **QFrame分隔线**：使用 `HLine` + `Sunken` 阴影效果
4. **字体增量更新**：系统性遍历所有QLabel、QPushButton、QComboBox、QLineEdit、QTableWidget、matplotlib字体设置

### 修改统计
- 修改行数：约60处
- 涉及方法：10个
- 样式更新：4类（按钮、标签、输入框、表格）
- 绘图调整：5个函数

---

**版本：** v2.4  
**更新日期：** 2025-12-03  
**状态：** ✅ 所有功能已实现并通过语法检查
