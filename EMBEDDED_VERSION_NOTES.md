# Auto Fitting Module - åµŒå…¥å¼ç‰ˆæœ¬è¯´æ˜

## ğŸ‰ æ›´æ–°å†…å®¹

ç°åœ¨auto fittingæ¨¡å—å·²ç»å®Œå…¨åµŒå…¥åˆ°ä¸»ç¨‹åºä¸­ï¼Œæ— éœ€ç‚¹å‡»æŒ‰é’®æ‰“å¼€æ–°çª—å£ï¼

## âœ¨ æ–°ç‰¹æ€§

### å®Œå…¨åµŒå…¥å¼ç•Œé¢
- âœ… ç›´æ¥æ˜¾ç¤ºåœ¨ä¸»ç¨‹åºå³ä¾§é¢æ¿
- âœ… matplotlibå›¾è¡¨åµŒå…¥åœ¨Qt6ç•Œé¢ä¸­
- âœ… æ‰€æœ‰æ§åˆ¶æŒ‰é’®å’ŒåŠŸèƒ½éƒ½åœ¨åŒä¸€ç•Œé¢
- âœ… æ— éœ€å¯åŠ¨å¤–éƒ¨tkinterçª—å£

### ç•Œé¢å¸ƒå±€

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  [Load File] [Auto Find] [Fit Peaks] [Reset] [Save]       â•‘
â•‘  Fit Method: [pseudo_voigt â–¼]  [BG Mode] Status: Ready    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                            â•‘
â•‘                  Matplotlib Plot Area                      â•‘
â•‘              (Interactive XRD Data Plot)                   â•‘
â•‘                                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Fitting Results Table                                     â•‘
â•‘  Peak | 2theta | FWHM | Area | Amplitude | Sigma | ...    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Info Panel                                                â•‘
â•‘  Log messages and status updates                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ”§ æŠ€æœ¯å®ç°

### ä»åŒ…è£…å™¨åˆ°å®Œå…¨åµŒå…¥

**ä¹‹å‰ï¼ˆåŒ…è£…å™¨ç‰ˆæœ¬ï¼‰ï¼š**
- ç‚¹å‡»æŒ‰é’® â†’ å¯åŠ¨subprocess â†’ æ‰“å¼€tkinterçª—å£
- ä¸¤ä¸ªç‹¬ç«‹è¿›ç¨‹è¿è¡Œ

**ç°åœ¨ï¼ˆåµŒå…¥ç‰ˆæœ¬ï¼‰ï¼š**
- ç›´æ¥åœ¨ä¸»ç¨‹åºä¸­æ˜¾ç¤º
- ä½¿ç”¨Qt6åŸç”Ÿç»„ä»¶
- matplotlibé€šè¿‡FigureCanvasQTAggåµŒå…¥
- å•ä¸€è¿›ç¨‹ï¼Œå®Œå…¨é›†æˆ

### æ ¸å¿ƒç»„ä»¶

1. **matplotlibé›†æˆ**
   ```python
   from matplotlib.backends.backend_qt5agg import FigureCanvasQTAgg
   self.canvas = FigureCanvas(self.fig)
   ```

2. **äº¤äº’å¼ç»˜å›¾**
   - ç‚¹å‡»é€‰æ‹©å³°
   - å³é”®åˆ é™¤å³°
   - æ»šè½®ç¼©æ”¾
   - å·¥å…·æ å¯¼èˆª

3. **Qt6æ§ä»¶**
   - QPushButton - æ“ä½œæŒ‰é’®
   - QComboBox - æ‹Ÿåˆæ–¹æ³•é€‰æ‹©
   - QTableWidget - ç»“æœæ˜¾ç¤º
   - QTextEdit - æ—¥å¿—ä¿¡æ¯

## ğŸ¨ ä¸»è¦åŠŸèƒ½

### åŸºæœ¬æ“ä½œ
1. **åŠ è½½æ•°æ®**ï¼šç‚¹å‡»"Load File"åŠ è½½XRDæ•°æ®æ–‡ä»¶
2. **è‡ªåŠ¨æ£€æµ‹**ï¼šç‚¹å‡»"Auto Find Peaks"è‡ªåŠ¨è¯†åˆ«å³°
3. **æ‰‹åŠ¨é€‰æ‹©**ï¼šå·¦é”®ç‚¹å‡»å›¾è¡¨æ·»åŠ å³°ï¼Œå³é”®åˆ é™¤
4. **èƒŒæ™¯æ‰£é™¤**ï¼šå¯ç”¨BGæ¨¡å¼ï¼Œé€‰æ‹©èƒŒæ™¯ç‚¹
5. **æ‹Ÿåˆå³°**ï¼šç‚¹å‡»"Fit Peaks"è¿›è¡Œæ‹Ÿåˆ
6. **ä¿å­˜ç»“æœ**ï¼šå¯¼å‡ºæ‹Ÿåˆç»“æœå’Œå›¾è¡¨

### äº¤äº’åŠŸèƒ½
- ğŸ–±ï¸ **é¼ æ ‡å·¦é”®**ï¼šé€‰æ‹©å³°ä½ç½®
- ğŸ–±ï¸ **é¼ æ ‡å³é”®**ï¼šåˆ é™¤å·²é€‰æ‹©çš„å³°
- ğŸ” **æ»šè½®ç¼©æ”¾**ï¼šç¼©æ”¾å›¾è¡¨
- ğŸ”§ **å·¥å…·æ **ï¼šå¹³ç§»ã€ç¼©æ”¾ã€ä¿å­˜å›¾è¡¨

## ğŸ“Š æ‹Ÿåˆæ–¹æ³•

æ”¯æŒä¸¤ç§æ‹Ÿåˆæ›²çº¿ï¼š
1. **Pseudo-Voigt**ï¼šæ··åˆé«˜æ–¯-æ´›ä¼¦å…¹çº¿å‹ï¼ˆé»˜è®¤ï¼‰
2. **Voigt**ï¼šçœŸå®Voigtçº¿å‹

## ğŸ’¾ è¾“å‡ºç»“æœ

ä¿å­˜æ—¶ä¼šç”Ÿæˆï¼š
1. **CSVæ–‡ä»¶**ï¼šåŒ…å«æ‰€æœ‰æ‹Ÿåˆå‚æ•°
   - Peak center (2theta)
   - FWHM
   - Area
   - Amplitude
   - Sigma, Gamma, Eta

2. **PNGå›¾åƒ**ï¼šåŒ…å«æ•°æ®å’Œæ‹Ÿåˆæ›²çº¿çš„å›¾è¡¨

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åœ¨ä¸»ç¨‹åºä¸­ä½¿ç”¨
1. å¯åŠ¨ä¸»ç¨‹åºï¼š`python main.py`
2. ç‚¹å‡»å·¦ä¾§"ğŸ” Auto Fit"æŒ‰é’®
3. ç•Œé¢ç›´æ¥æ˜¾ç¤ºåœ¨å³ä¾§é¢æ¿
4. å¼€å§‹ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½

### ç‹¬ç«‹æµ‹è¯•
```bash
python test_auto_fitting_embedded.py
```

## ğŸ”„ ä¸åŸç‰ˆæœ¬çš„æ¯”è¾ƒ

| ç‰¹æ€§ | åŒ…è£…å™¨ç‰ˆæœ¬ | åµŒå…¥ç‰ˆæœ¬ âœ¨ |
|------|-----------|------------|
| ç•Œé¢ä½ç½® | æ–°çª—å£ | ä¸»ç¨‹åºå†… |
| å¯åŠ¨æ–¹å¼ | subprocess | ç›´æ¥æ˜¾ç¤º |
| GUIæ¡†æ¶ | tkinter | Qt6 |
| é›†æˆåº¦ | ç‹¬ç«‹è¿›ç¨‹ | å®Œå…¨é›†æˆ |
| ç”¨æˆ·ä½“éªŒ | éœ€è¦å¤šçª—å£ | å•ä¸€ç•Œé¢ |
| ç»´æŠ¤æ€§ | ä¾èµ–å¤–éƒ¨æ–‡ä»¶ | è‡ªåŒ…å« |

## ğŸ“ ä»£ç ç»“æ„

```python
class AutoFittingModule(QWidget):
    def __init__(self, parent=None):
        # åˆå§‹åŒ–æ•°æ®å­˜å‚¨
        self.x = None
        self.y = None
        self.selected_peaks = []
        # ...
        self.setup_ui()
    
    def setup_ui(self):
        # åˆ›å»ºæ§åˆ¶é¢æ¿
        self.create_control_panel(layout)
        # åˆ›å»ºmatplotlibå›¾è¡¨
        self.create_plot_area(layout)
        # åˆ›å»ºç»“æœè¡¨æ ¼
        self.create_results_panel(layout)
        # åˆ›å»ºä¿¡æ¯é¢æ¿
        self.create_info_panel(layout)
    
    # æ ¸å¿ƒåŠŸèƒ½æ–¹æ³•
    def load_file(self): ...
    def auto_find_peaks(self): ...
    def fit_peaks(self): ...
    def save_results(self): ...
```

## ğŸ”§ ä¾èµ–é¡¹

å¿…éœ€ï¼š
- PyQt6
- matplotlib
- numpy
- scipy
- pandas
- scikit-learn

å¯é€‰ï¼ˆä»åŸæ–‡ä»¶å¯¼å…¥ï¼‰ï¼š
- auto_fitting.pyï¼ˆæä¾›æ•°æ®å¤„ç†ç±»ï¼‰

## ğŸ› å·²çŸ¥é™åˆ¶

å½“å‰ç‰ˆæœ¬æä¾›æ ¸å¿ƒåŠŸèƒ½ï¼Œç›¸æ¯”å®Œæ•´çš„tkinterç‰ˆæœ¬ï¼š

**å·²å®ç°ï¼š**
- âœ… åŠ è½½XRDæ•°æ®æ–‡ä»¶
- âœ… è‡ªåŠ¨å³°æ£€æµ‹
- âœ… æ‰‹åŠ¨å³°é€‰æ‹©ï¼ˆç‚¹å‡»æ·»åŠ /åˆ é™¤ï¼‰
- âœ… èƒŒæ™¯ç‚¹é€‰æ‹©
- âœ… Pseudo-Voigtæ‹Ÿåˆ
- âœ… ç»“æœè¡¨æ ¼æ˜¾ç¤º
- âœ… ä¿å­˜ç»“æœï¼ˆCSV + PNGï¼‰
- âœ… äº¤äº’å¼å›¾è¡¨ï¼ˆç¼©æ”¾ã€å¹³ç§»ï¼‰

**ç®€åŒ–åŠŸèƒ½ï¼š**
- âš ï¸ æ‰¹å¤„ç†æ¨¡å¼ï¼ˆå¯ä»¥åç»­æ·»åŠ ï¼‰
- âš ï¸ é«˜çº§æ‹Ÿåˆå‚æ•°è°ƒæ•´
- âš ï¸ æ–‡ä»¶å¯¼èˆªï¼ˆä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªï¼‰
- âš ï¸ Undo/RedoåŠŸèƒ½

å¦‚éœ€å®Œæ•´åŠŸèƒ½ï¼Œå¯ä»¥ç»§ç»­å¢å¼ºæ­¤ç‰ˆæœ¬æˆ–ä½¿ç”¨åŸå§‹çš„tkinterç‰ˆæœ¬ã€‚

## ğŸ¯ ä¸‹ä¸€æ­¥

å¦‚æœéœ€è¦æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥ï¼š

1. **æ·»åŠ æ‰¹å¤„ç†**ï¼šå®ç°æ–‡ä»¶å¤¹æ‰¹é‡å¤„ç†
2. **é«˜çº§è®¾ç½®**ï¼šæ·»åŠ æ‹Ÿåˆå‚æ•°è°ƒæ•´å¯¹è¯æ¡†
3. **æ–‡ä»¶å¯¼èˆª**ï¼šæ·»åŠ ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªæ–‡ä»¶æŒ‰é’®
4. **å¯¼å‡ºé€‰é¡¹**ï¼šæ”¯æŒæ›´å¤šå¯¼å‡ºæ ¼å¼
5. **æ’¤é”€é‡åš**ï¼šå®ç°æ“ä½œå†å²æ ˆ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- æ–‡ä»¶ä½ç½®ï¼š`/workspace/auto_fitting_module.py`
- æµ‹è¯•è„šæœ¬ï¼š`/workspace/test_auto_fitting_embedded.py`
- åŸå§‹ç‰ˆæœ¬ï¼š`/workspace/auto_fitting.py`ï¼ˆä¿ç•™ä½œä¸ºå‚è€ƒï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-12-03  
**ç‰ˆæœ¬**: v2.0 - Embedded Edition
