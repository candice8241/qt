# å †å å›¾æ ‡ç­¾å¯¹é½ - åŸºçº¿ä¿®æ­£

## æ—¥æœŸï¼š2025-12-02 (åŸºçº¿ç‰ˆæœ¬)

---

## âœ… æœ€ç»ˆæ­£ç¡®çš„å®ç°

### æ ‡ç­¾ä½ç½®ï¼šåŸºçº¿ / Label Position: Baseline

```python
# æ ‡ç­¾ç›´æ¥æ”¾åœ¨åŸºçº¿ä½ç½®
y_pos = y_offset

# æ ‡ç­¾åº•éƒ¨å¯¹é½ï¼Œæ–‡å­—å‘ä¸Š
plt.text(x_pos, y_pos, label,
        fontsize=10,
        verticalalignment='bottom',  # åº•éƒ¨å¯¹é½
        color=color,                  # æ— èƒŒæ™¯æ¡†
        fontweight='bold')            # ç²—ä½“
```

---

## ğŸ“Š è§†è§‰æ•ˆæœ / Visual Effect

```
Intensity
    â†‘
    â”‚     â•±â•²              â† æ›²çº¿å³°å€¼
    â”‚    â•±  â•²
    â”‚   â•±    â•²
    â”‚  â•±      â•²
    â”‚ â•±        â•²
    â”‚â•±__________â•²
    â”‚10.5 GPa         â† æ ‡ç­¾åº•éƒ¨åœ¨åŸºçº¿ï¼Œæ–‡å­—å‘ä¸Š
    â”‚â”â”â”â”â”â”â”â”â”â”â”â”     â† åŸºçº¿ (y_offset)
    â”‚
    â”‚
    â”‚     â•±â•²
    â”‚    â•±  â•²
    â”‚   â•±    â•²
    â”‚  â•±      â•²
    â”‚ â•±        â•²
    â”‚â•±__________â•²
    â”‚20.0 GPa         â† ç¬¬äºŒæ¡æ›²çº¿çš„æ ‡ç­¾
    â”‚â”â”â”â”â”â”â”â”â”â”â”â”     â† åŸºçº¿ (y_offset + offset)
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ 2Î¸
```

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ / Core Concept

### æ›²çº¿å †å æ–¹å¼ / How Curves Are Stacked

```python
# ç¬¬1æ¡æ›²çº¿: y_offset = 0
plt.plot(x, data1 + 0, ...)
æ ‡ç­¾ä½ç½®: y_pos = 0

# ç¬¬2æ¡æ›²çº¿: y_offset = 1000
plt.plot(x, data2 + 1000, ...)
æ ‡ç­¾ä½ç½®: y_pos = 1000

# ç¬¬3æ¡æ›²çº¿: y_offset = 2000
plt.plot(x, data3 + 2000, ...)
æ ‡ç­¾ä½ç½®: y_pos = 2000
```

**æ ‡ç­¾ç²¾ç¡®å¯¹åº”æ¯æ¡æ›²çº¿çš„åŸºçº¿ï¼**

---

## âœ¨ å…³é”®ç‰¹æ€§ / Key Features

### 1. ç®€å•æ˜ç¡® / Simple and Clear

```python
y_pos = y_offset  # ç›´æ¥ä½¿ç”¨offsetï¼Œæ— éœ€å¤æ‚è®¡ç®—
```

- ä¸éœ€è¦è®¡ç®—min/max
- ä¸éœ€è¦è®¡ç®—ä¸­ç‚¹
- ç›´æ¥å¯¹åº”æ›²çº¿çš„åŸºçº¿

### 2. ç²¾ç¡®å¯¹é½ / Precise Alignment

- æ¯ä¸ªæ ‡ç­¾çš„yä½ç½® = å¯¹åº”æ›²çº¿çš„y_offset
- ç¬¬1æ¡æ›²çº¿: offset=0, æ ‡ç­¾åœ¨y=0
- ç¬¬2æ¡æ›²çº¿: offset=1000, æ ‡ç­¾åœ¨y=1000
- ç¬¬3æ¡æ›²çº¿: offset=2000, æ ‡ç­¾åœ¨y=2000

### 3. éšOffsetè‡ªåŠ¨è°ƒæ•´ / Auto-adjusts with Offset

```
Offset=1000:  æ ‡ç­¾åœ¨ 0, 1000, 2000, ...
Offset=1500:  æ ‡ç­¾åœ¨ 0, 1500, 3000, ...
Offset=800:   æ ‡ç­¾åœ¨ 0, 800, 1600, ...
```

**æ ‡ç­¾å§‹ç»ˆè·ŸéšåŸºçº¿ï¼**

### 4. å‚ç›´å¯¹é½æ–¹å¼ / Vertical Alignment

```python
verticalalignment='bottom'
```

- æ ‡ç­¾**åº•éƒ¨**å¯¹é½åˆ°y_posï¼ˆå³åŸºçº¿ï¼‰
- æ–‡å­—å‘**ä¸Š**å»¶ä¼¸
- ä¸ä¼šä¾µå…¥åŸºçº¿ä»¥ä¸‹åŒºåŸŸ
- æ¸…æ™°æ ‡è¯†æ¯æ¡æ›²çº¿çš„èµ·ç‚¹

---

## ğŸ”§ å®Œæ•´ä»£ç  / Complete Code

### æ ‡ç­¾ç»˜åˆ¶éƒ¨åˆ† / Label Drawing Section

```python
for idx, (data, pressure, is_unload) in enumerate(zip(data_list, pressures, is_unload_list)):
    # è®¡ç®—å½“å‰æ›²çº¿çš„offset
    y_offset = idx * calc_offset
    
    # ç»˜åˆ¶æ›²çº¿
    plt.plot(data[:, 0], data[:, 1] + y_offset,
            color=colors[color_idx], linewidth=1.2)
    
    # æ ‡ç­¾ä½ç½®ï¼šç›´æ¥åœ¨åŸºçº¿
    x_pos = data[0, 0] + (data[-1, 0] - data[0, 0]) * 0.02
    y_pos = y_offset  # â† å…³é”®ï¼šæ ‡ç­¾åœ¨åŸºçº¿
    
    # ç»˜åˆ¶æ ‡ç­¾
    label = f'{pressure:.1f} GPa'
    plt.text(x_pos, y_pos, label,
            fontsize=10,
            verticalalignment='bottom',  # åº•éƒ¨å¯¹é½
            color=colors[color_idx],
            fontweight='bold')
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶ / Modified Files

### 2ä¸ªæ–‡ä»¶ï¼Œ4å¤„ä¿®æ”¹ / 2 Files, 4 Changes

âœ… **radial_module.py**
- `_create_single_pressure_stacked_plot()` - çº¦ç¬¬1650è¡Œ
- `_create_all_pressure_stacked_plot()` - çº¦ç¬¬1745è¡Œ

âœ… **batch_integration.py**  
- `_create_single_pressure_stacked_plot()` - çº¦ç¬¬570è¡Œ
- `_create_all_pressure_stacked_plot()` - çº¦ç¬¬675è¡Œ

### ä»£ç å˜åŒ– / Code Changes

**åˆ é™¤ï¼ˆå¤æ‚è®¡ç®—ï¼‰ï¼š**
```python
min_intensity = np.min(data[:, 1])
max_intensity = np.max(data[:, 1])
y_pos = y_offset + (min_intensity + max_intensity) / 2.0
```

**æ·»åŠ ï¼ˆç®€å•ç›´æ¥ï¼‰ï¼š**
```python
y_pos = y_offset
```

**å‡€å‡å°‘ï¼š** çº¦12è¡Œä»£ç 

---

## ğŸ§® æ•°å­¦éªŒè¯ / Mathematical Verification

### ç¤ºä¾‹è®¡ç®— / Example Calculation

**å‡è®¾ï¼š**
- Offset = 1200
- æœ‰3æ¡æ›²çº¿

**è®¡ç®—ï¼š**
```python
æ›²çº¿1:
  y_offset = 0 * 1200 = 0
  æ›²çº¿æ•°æ®: y = data1 + 0
  æ ‡ç­¾ä½ç½®: y_pos = 0  â† åœ¨åŸºçº¿

æ›²çº¿2:
  y_offset = 1 * 1200 = 1200
  æ›²çº¿æ•°æ®: y = data2 + 1200
  æ ‡ç­¾ä½ç½®: y_pos = 1200  â† åœ¨åŸºçº¿

æ›²çº¿3:
  y_offset = 2 * 1200 = 2400
  æ›²çº¿æ•°æ®: y = data3 + 2400
  æ ‡ç­¾ä½ç½®: y_pos = 2400  â† åœ¨åŸºçº¿
```

**ç»“è®ºï¼š** æ¯ä¸ªæ ‡ç­¾ç²¾ç¡®å¯¹åº”å…¶æ›²çº¿çš„åŸºçº¿ï¼

---

## ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨åŸºçº¿ / Why Use Baseline

### ä¼˜åŠ¿ / Advantages

1. **æ¦‚å¿µæ¸…æ™° / Clear Concept**
   - åŸºçº¿æ˜¯æ›²çº¿å †å çš„å‚è€ƒç‚¹
   - æ ‡ç­¾åœ¨åŸºçº¿æ¸…æ¥šæ ‡è¯†æ¯æ¡æ›²çº¿çš„èµ·ç‚¹

2. **å®ç°ç®€å• / Simple Implementation**
   - æ— éœ€è®¡ç®—æ•°æ®çš„min/max
   - æ— éœ€è®¡ç®—ä¸­ç‚¹
   - ä»£ç æ›´ç®€æ´

3. **è§†è§‰ç›´è§‚ / Visually Intuitive**
   - æ ‡ç­¾ç›´æ¥æ ‡è¯†æ›²çº¿çš„åŸºçº¿ä½ç½®
   - å®¹æ˜“ç†è§£offsetçš„ä½œç”¨

4. **ç¨³å®šå¯é  / Stable and Reliable**
   - ä¸å—æ•°æ®å™ªå£°å½±å“
   - ä¸å—å³°å½¢å˜åŒ–å½±å“
   - å§‹ç»ˆåœ¨å›ºå®šçš„offsetä½ç½®

---

## ğŸ¨ æ ·å¼ä¿æŒ / Style Maintained

### ä¿ç•™çš„ä¼˜åŒ– / Kept Optimizations

âœ… **æ— èƒŒæ™¯æ¡†** - ç§»é™¤äº†bboxå‚æ•°ï¼Œç®€æ´æ¸…çˆ½
âœ… **ç²—ä½“å­—** - fontweight='bold'ï¼Œæ¸…æ™°çªå‡º
âœ… **æ›²çº¿é¢œè‰²** - color=colorï¼Œè§†è§‰ç»Ÿä¸€
âœ… **å­—ä½“10pt** - æ¯”åŸæ¥çš„9ptç•¥å¤§ï¼Œæ˜“è¯»

---

## ğŸ”„ å¯¹æ¯”å†å²ç‰ˆæœ¬ / Comparison with Previous Versions

### ç‰ˆæœ¬æ¼”å˜ / Version Evolution

**ç‰ˆæœ¬1ï¼šåŸºçº¿+30%**
```python
y_pos = y_offset + np.max(data[:, 1]) * 0.3
```
âŒ é—®é¢˜ï¼šæ ‡ç­¾ä½ç½®å–å†³äºå³°é«˜ï¼Œä¸ç¨³å®š

**ç‰ˆæœ¬2ï¼šæ•°æ®ä¸­ç‚¹**
```python
y_pos = y_offset + (min + max) / 2.0
```
âŒ é—®é¢˜ï¼šç”¨æˆ·åé¦ˆä»ç„¶å¯¹ä¸ä¸Š

**ç‰ˆæœ¬3ï¼šåŸºçº¿ï¼ˆå½“å‰ï¼‰**
```python
y_pos = y_offset
```
âœ… ä¼˜åŠ¿ï¼šæœ€ç®€å•ã€æœ€ç›´æ¥ã€æœ€ç¨³å®š

---

## âœ… æœ€ç»ˆæ•ˆæœ / Final Result

### æ ‡ç­¾ç‰¹æ€§ / Label Features

- âœ… æ ‡ç­¾åœ¨åŸºçº¿ä½ç½®ï¼Œç²¾ç¡®å¯¹åº”æ›²çº¿èµ·ç‚¹
- âœ… æ ‡ç­¾åº•éƒ¨å¯¹é½ï¼Œæ–‡å­—å‘ä¸Šå»¶ä¼¸
- âœ… éšoffsetå˜åŒ–è‡ªåŠ¨è°ƒæ•´
- âœ… æ— èƒŒæ™¯æ¡†ï¼Œç²—ä½“å½©è‰²ï¼Œ10ptå­—ä½“

### ç”¨æˆ·ä½“éªŒ / User Experience

- âœ… æ¸…æ¥šæ ‡è¯†æ¯æ¡æ›²çº¿çš„åŸºçº¿
- âœ… å‹åŠ›å€¼ä¸æ›²çº¿ç²¾ç¡®å¯¹åº”
- âœ… è§†è§‰ç®€æ´ä¸“ä¸š
- âœ… æ˜“äºç†è§£å’Œé˜…è¯»

---

## ğŸ“š ç›¸å…³æ–‡æ¡£ / Related Documentation

1. **æœ¬æ–‡æ¡£** - æ ‡ç­¾å¯¹é½åŸºçº¿ä¿®æ­£.md
2. **ä»£ç æ–‡ä»¶** - radial_module.py, batch_integration.py
3. **Gitå†å²** - å¯æŸ¥çœ‹å®Œæ•´ä¿®æ”¹å†å²

---

**ç‰ˆæœ¬ / Version:** 1.5.0 (åŸºçº¿ç‰ˆæœ¬)  
**æ—¥æœŸ / Date:** 2025-12-02  
**çŠ¶æ€ / Status:** âœ… åŸºçº¿å¯¹é½å®ç°

---

**ğŸ¯ æ ‡ç­¾ç°åœ¨ç²¾ç¡®å¯¹é½åˆ°æ›²çº¿åŸºçº¿ï¼**  
**Labels Now Precisely Aligned to Curve Baselines!**

**è¿™æ˜¯æœ€ç®€å•ã€æœ€ç›´æ¥çš„å®ç°ï¼**  
**This Is the Simplest and Most Direct Implementation!**
