# Auto Fitting Module - 完整文档

## 🎯 快速开始

### 启动方式
```bash
python main.py
```
然后点击左侧导航栏的 **"🔍 Auto Fit"** 按钮，界面会直接显示在右侧！

---

## 📖 文档导航

### 核心文档
- **[FINAL_SUMMARY.txt](FINAL_SUMMARY.txt)** - ⭐ 快速参考，包含所有重要信息
- **[UI_LAYOUT_GUIDE.txt](UI_LAYOUT_GUIDE.txt)** - 📐 详细的界面布局说明
- **[EMBEDDED_VERSION_NOTES.md](EMBEDDED_VERSION_NOTES.md)** - 📝 功能说明和技术细节
- **[VERSION_COMPARISON.md](VERSION_COMPARISON.md)** - 📊 三个版本的详细对比

### 测试文件
- **[test_auto_fitting_embedded.py](test_auto_fitting_embedded.py)** - 独立测试脚本

---

## ✨ 主要特性

### 🎨 用户界面
- ✅ **完全嵌入** - 直接显示在主程序中，无需额外窗口
- ✅ **单一操作** - 点击侧边栏按钮即可使用
- ✅ **现代设计** - 淡紫色主题，清晰美观

### 📊 数据处理
- ✅ **多格式支持** - .xy, .dat, .txt文件
- ✅ **自动检测** - 智能峰识别算法
- ✅ **手动选择** - 点击添加/删除峰
- ✅ **背景扣除** - 交互式背景点选择

### 🔬 拟合功能
- ✅ **Pseudo-Voigt拟合** - 混合高斯-洛伦兹线型
- ✅ **实时结果** - 表格显示所有参数
- ✅ **可视化** - 图表叠加拟合曲线
- ✅ **一键保存** - 导出CSV和PNG

### 🖱️ 交互体验
- ✅ **点击选择** - 左键添加峰，右键删除
- ✅ **滚轮缩放** - 自由缩放图表
- ✅ **工具栏** - 完整的matplotlib导航工具

---

## 🚀 使用流程

### 1. 加载数据
点击 **Load File** 按钮，选择XRD数据文件（.xy, .dat, .txt格式）

### 2. 选择峰
**方式A - 自动检测：**
- 点击 **Auto Find Peaks** 按钮
- 系统自动识别所有峰

**方式B - 手动选择：**
- 左键点击图表上的峰位置
- 右键点击已选择的峰删除

**方式C - 混合使用：**
- 先自动检测
- 再手动调整

### 3. 背景扣除（可选）
- 点击 **BG Selection Mode** 启用背景模式
- 在数据曲线低点处点击选择背景点
- 系统自动插值拟合背景

### 4. 拟合峰
- 点击 **Fit Peaks** 按钮
- 等待拟合完成（通常几秒钟）
- 查看结果表格和图表

### 5. 保存结果
- 点击 **Save Results** 按钮
- 选择保存目录
- 生成CSV文件和PNG图像

---

## 📊 界面布局

```
┌─────────┬───────────────────────────────────────────────┐
│ 侧边栏   │              Auto Fitting 界面                 │
│         │  ┌─────────────────────────────────────────┐  │
│ • Mask  │  │ [Load] [Auto] [Fit] [Reset] [Save]     │  │
│ • Batch │  │ Method:[▼] BG:[OFF] Status: Ready      │  │
│ • BCDI  │  └─────────────────────────────────────────┘  │
│ • Dioptas│                                              │
│ • Auto◄ │  ┌─────────────────────────────────────────┐ │
│ • Curve │  │                                         │ │
│ • EOS   │  │      Matplotlib 交互式图表              │ │
│         │  │                                         │ │
│         │  │  • 数据曲线                             │ │
│         │  │  • 峰标记                               │ │
│         │  │  • 拟合结果                             │ │
│         │  │                                         │ │
│         │  └─────────────────────────────────────────┘ │
│         │                                              │
│         │  ┌─────────────────────────────────────────┐ │
│         │  │ 结果表格                                 │ │
│         │  │ Peak | 2theta | FWHM | Area | ...       │ │
│         │  └─────────────────────────────────────────┘ │
│         │                                              │
│         │  ┌─────────────────────────────────────────┐ │
│         │  │ 信息日志                                 │ │
│         │  │ > Status messages...                     │ │
│         │  └─────────────────────────────────────────┘ │
└─────────┴───────────────────────────────────────────────┘
```

详细布局说明请查看 [UI_LAYOUT_GUIDE.txt](UI_LAYOUT_GUIDE.txt)

---

## 🔧 技术实现

### 核心技术栈
- **GUI框架**: PyQt6
- **绘图库**: matplotlib (通过FigureCanvasQTAgg嵌入)
- **数据处理**: numpy, scipy, pandas
- **拟合算法**: Pseudo-Voigt (高斯-洛伦兹混合)

### 关键代码
```python
from auto_fitting_module import AutoFittingModule

# 创建模块
module = AutoFittingModule()

# 嵌入到主程序
layout.addWidget(module)
```

### 文件结构
```
/workspace/
├── auto_fitting_module.py        # ⭐ 嵌入式Qt6模块（当前版本）
├── main.py                        # 主程序（已更新集成）
├── auto_fitting.py                # 原始tkinter版本（保留）
├── test_auto_fitting_embedded.py  # 测试脚本
└── 文档/
    ├── AUTO_FITTING_README.md     # 本文件
    ├── FINAL_SUMMARY.txt          # 快速参考
    ├── UI_LAYOUT_GUIDE.txt        # 界面说明
    ├── EMBEDDED_VERSION_NOTES.md  # 技术文档
    └── VERSION_COMPARISON.md      # 版本对比
```

---

## 📈 版本历史

### v2.0 - Embedded Edition (当前) ✨
- **类型**: 完全嵌入式Qt6版本
- **特点**: 直接显示在主程序中，无需额外窗口
- **功能**: 核心功能完整，用户体验最佳
- **推荐**: ⭐⭐⭐⭐⭐ 日常使用首选

### v1.5 - Launcher Edition
- **类型**: Qt6包装器
- **特点**: 点击按钮启动tkinter窗口
- **功能**: 完整（调用原版）
- **推荐**: ⭐⭐⭐ 快速集成方案

### v1.0 - Original Edition
- **类型**: 原始tkinter版本
- **特点**: 独立运行，功能最完整
- **功能**: 包含批处理等高级功能
- **推荐**: ⭐⭐⭐⭐ 高级用户和批处理

详细对比请查看 [VERSION_COMPARISON.md](VERSION_COMPARISON.md)

---

## 💡 常见问题

### Q: 如何选择多个峰？
A: 直接在图表上多次点击不同的峰位置即可。

### Q: 如何删除错误选择的峰？
A: 右键点击该峰，或点击Reset按钮清除所有。

### Q: 拟合失败怎么办？
A: 
1. 检查是否选择了足够的峰
2. 尝试选择背景点改善拟合
3. 确保数据质量良好

### Q: 可以批处理多个文件吗？
A: 当前版本专注于单文件处理。如需批处理，请使用原始tkinter版本。

### Q: 结果保存在哪里？
A: 保存时会弹出对话框，可以选择任意目录。生成两个文件：
- `{filename}_fit_results.csv` - 拟合参数
- `{filename}_fit_plot.png` - 图表

---

## 🎯 性能建议

### 推荐配置
- **数据点数**: < 10,000 点（推荐）
- **峰数量**: < 50 个（推荐）
- **文件大小**: < 1 MB

### 优化技巧
1. 使用自动检测前先缩放到感兴趣区域
2. 选择5-10个背景点即可，无需过多
3. 对于大数据集，可以先在小范围测试参数

---

## 🆘 技术支持

### 问题报告
如遇到问题，请提供：
1. 数据文件示例
2. 操作步骤
3. 错误信息截图

### 功能请求
欢迎提出新功能建议！当前计划添加：
- [ ] 批处理模式
- [ ] 文件导航（上一个/下一个）
- [ ] 撤销/重做功能
- [ ] 更多拟合模型

---

## 📚 延伸阅读

### 推荐资料
- **Pseudo-Voigt函数**: 混合高斯和洛伦兹线型
- **XRD数据分析**: X射线衍射基础
- **峰拟合算法**: scipy.optimize文档

### 相关工具
- **Dioptas**: 集成在主程序中的XRD处理工具
- **原始Auto Fitting**: 完整版tkinter应用

---

## 📄 许可证

基于原始auto_fitting.py的开源协议

---

## 👥 贡献者

- 原始代码: candicewang928@gmail.com
- Qt6移植: Claude Sonnet 4.5

---

## 📞 联系方式

- 问题反馈: 通过主程序issue系统
- 功能建议: 欢迎提交PR

---

**最后更新**: 2025-12-03  
**版本**: v2.0 - Embedded Edition  
**状态**: ✅ 生产就绪

---

## 🎉 开始使用

```bash
# 1. 启动主程序
python main.py

# 2. 点击左侧 "🔍 Auto Fit"
# 3. 开始使用！
```

祝使用愉快！ 🚀
