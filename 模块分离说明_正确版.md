# æ¨¡å—åˆ†ç¦»è¯´æ˜ - Batch Fitting Module (æ­£ç¡®ç‰ˆ)

## éœ€æ±‚ç†è§£

**ç”¨æˆ·éœ€æ±‚ï¼š**
1. å°† `interactive_fitting_gui.py` (curvefit) ä¸­çš„ batch åŠŸèƒ½å•ç‹¬æ‹¿å‡ºæ¥ä½œä¸ºä¸€ä¸ªæ¨¡å—
2. éšè— curvefit æ¨¡å—

**å…³é”®æ–‡ä»¶ï¼š**
- `interactive_fitting_gui.py` - curvefitä¸»æ¨¡å—ï¼ˆåŒ…å«batchæŒ‰é’®ï¼‰
- `batch_fitting_dialog.py` - batchåŠŸèƒ½çš„å®Œæ•´å®ç°ï¼ˆ1348è¡Œï¼‰

---

## å®ç°æ–¹æ¡ˆ

### 1. åˆ›å»ºç‹¬ç«‹çš„Batch Fittingæ¨¡å— âœ…

**æ–°æ–‡ä»¶ï¼š** `batch_fitting_module.py`

**åŠŸèƒ½ï¼š**
- å°† `BatchFittingDialog` ä»å¯¹è¯æ¡†æ¨¡å¼æ”¹ä¸ºåµŒå…¥å¼æ¨¡å—
- ç›´æ¥æ˜¾ç¤ºbatchæ‰¹å¤„ç†ç•Œé¢
- æ— éœ€ç‚¹å‡»æŒ‰é’®æ‰“å¼€ï¼Œç›´æ¥å¯ç”¨

**æŠ€æœ¯å®ç°ï¼š**
```python
class BatchFittingModule(QWidget):
    """Batch Fitting Module - Direct embedding"""
    
    def __init__(self, parent_frame=None, main_window=None):
        super().__init__(parent_frame)
        
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        
        # åˆ›å»ºbatchå¯¹è¯æ¡†ä½œä¸ºwidgetåµŒå…¥
        self.batch_dialog = BatchFittingDialog(parent=None)
        
        # ç§»é™¤å¯¹è¯æ¡†çª—å£æ ‡å¿—ï¼Œä½¿å…¶å¯åµŒå…¥
        self.batch_dialog.setWindowFlags(
            self.batch_dialog.windowFlags() & ~Qt.WindowType.Dialog
        )
        
        layout.addWidget(self.batch_dialog)
```

**å…³é”®æŠ€æœ¯ç‚¹ï¼š**
- ä½¿ç”¨ `BatchFittingDialog` çš„å®Œæ•´åŠŸèƒ½
- ç§»é™¤ `Qt.WindowType.Dialog` æ ‡å¿—ä½¿å…¶å¯åµŒå…¥
- ä½œä¸ºæ™®é€šwidgetæ˜¾ç¤ºï¼Œè€Œéå¼¹å‡ºçª—å£

---

### 2. ä¿®æ”¹main.py - æ·»åŠ Batch Fitæ¨¡å— âœ…

#### 2.1 ä¾§è¾¹æ æŒ‰é’®è°ƒæ•´

```python
# æ·»åŠ Batch FittingæŒ‰é’®
self.batch_fitting_btn = self.create_sidebar_button(
    "ğŸ“Š  Batch Fit", 
    lambda: self.switch_tab("batch_fitting"), 
    is_active=False
)
sidebar_layout.addWidget(self.batch_fitting_btn)

# éšè—curvefitæŒ‰é’®
# self.curvefit_btn = self.create_sidebar_button("ğŸ“ˆ  curvefit", ...)
# sidebar_layout.addWidget(self.curvefit_btn)
```

#### 2.2 æ³¨å†Œbatch_fittingæ¨¡å—

```python
# æ¨¡å—å®¹å™¨
self.module_frames = {
    ...
    "batch_fitting": None  # NEW!
}

# æ¨¡å—å®ä¾‹
self.batch_fitting_module = None  # NEW!
```

#### 2.3 æ¨¡å—é¢„æ„å»º

```python
def prebuild_modules(self):
    ...
    batch_fitting_frame = self._ensure_frame("batch_fitting")
    if self.batch_fitting_module is None:
        self.batch_fitting_module = BatchFittingModule(batch_fitting_frame, self)
        self.batch_fitting_module.setup_ui()
    batch_fitting_frame.hide()
```

#### 2.4 æ ‡ç­¾åˆ‡æ¢

```python
def switch_tab(self, tab_name):
    ...
    elif tab_name == "batch_fitting":
        target_frame = self._ensure_frame("batch_fitting")
        if self.batch_fitting_module is None:
            self.batch_fitting_module = BatchFittingModule(target_frame, self)
            self.batch_fitting_module.setup_ui()
```

---

### 3. éšè—curvefitæ¨¡å— âœ…

**åœ¨main.pyä¸­æ³¨é‡Šæ‰ï¼š**
```python
# Line 161-162 (approximately)
# self.curvefit_btn = self.create_sidebar_button("ğŸ“ˆ  curvefit", self.open_curvefit, is_active=False)
# sidebar_layout.addWidget(self.curvefit_btn)

# Line 357 (approximately) - buttonså­—å…¸ä¸­
# "curvefit": self.curvefit_btn,  # Hidden
```

**ä¿ç•™çš„å†…å®¹ï¼š**
- `interactive_fitting_gui.py` - æ–‡ä»¶å®Œæ•´ä¿ç•™
- `open_curvefit()` æ–¹æ³• - ä¿ç•™ä½†ä¸è°ƒç”¨
- å¯é€šè¿‡å–æ¶ˆæ³¨é‡Šå¿«é€Ÿæ¢å¤

---

## ä¾§è¾¹æ å¸ƒå±€

### æ›´æ–°å‰åå¯¹æ¯”

**ã€ä¹‹å‰ã€‘**
```
ğŸ­  Mask
âš—ï¸  Batch Int.
ğŸ”¬  BCDI Cal.
ğŸ’  Dioptas
ğŸ”  Auto Fit
ğŸ“ˆ  curvefit        â† å¯è§
ğŸ“Š  eosfit
```

**ã€ç°åœ¨ã€‘**
```
ğŸ­  Mask
âš—ï¸  Batch Int.
ğŸ”¬  BCDI Cal.
ğŸ’  Dioptas
ğŸ”  Auto Fit
ğŸ“Š  Batch Fit      â† NEW! (æ¥è‡ªcurvefitçš„batchåŠŸèƒ½)
ğŸ“Š  eosfit
```

**å˜åŒ–è¯´æ˜ï¼š**
- âœ… æ·»åŠ ï¼š`ğŸ“Š  Batch Fit` (æ¥è‡ªinteractive_fitting_gui.pyçš„batchåŠŸèƒ½)
- âœ… éšè—ï¼š`ğŸ“ˆ  curvefit` (interactive_fitting_guiæ•´ä¸ªæ¨¡å—)

---

## Batch Fitting æ¨¡å—ç•Œé¢

### å®Œæ•´åŠŸèƒ½ç•Œé¢ï¼ˆç›´æ¥åµŒå…¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Batch Peak Fitting - Interactive Mode                    â”‚
â”‚                                         ğŸ“ Load Folder       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ğŸ“„ File  â”‚  Add Mode: [ğŸ”´ Peak] [ğŸ”µ Background]             â”‚
â”‚ List    â”‚  Fit Method: [Pseudo-Voigt â–¼]                     â”‚
â”‚         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚file1.xy â”‚  [ğŸ”Auto Detect] [ğŸ—‘ï¸Clear All] [ğŸ”Reset Zoom]   â”‚
â”‚file2.xy â”‚  [âœ¨Fit Current] [âš¡Auto Fit] [ğŸ“ŠOverlap]        â”‚
â”‚file3.xy â”‚  ğŸ’¡ Left:Add | Right:Delete | Enter:Auto-fit     â”‚
â”‚  ...    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”‚              [ç»˜å›¾åŒºåŸŸæ˜¾ç¤ºXRDæ•°æ®]                 â”‚
â”‚         â”‚                                                    â”‚
â”‚Loaded   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚10 files â”‚  [1/10] file1.xy  [â¬…Previous] [Nextâ¡] [ğŸ’¾Save]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½ç‰¹æ€§

#### æ–‡ä»¶ç®¡ç†
- âœ… åŠ è½½æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰.xyæ–‡ä»¶
- âœ… æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
- âœ… ç‚¹å‡»åˆ‡æ¢æ–‡ä»¶
- âœ… å‰åå¯¼èˆªæŒ‰é’®

#### äº¤äº’å¼æ“ä½œ
- âœ… å·¦é”®ç‚¹å‡»æ·»åŠ å³°/èƒŒæ™¯ç‚¹
- âœ… å³é”®ç‚¹å‡»åˆ é™¤å³°/èƒŒæ™¯ç‚¹
- âœ… è‡ªåŠ¨æ£€æµ‹å³°
- âœ… æ¸…é™¤æ‰€æœ‰æ ‡è®°
- âœ… æ»šè½®ç¼©æ”¾
- âœ… é‡ç½®ç¼©æ”¾

#### æ‹ŸåˆåŠŸèƒ½
- âœ… å•æ–‡ä»¶æ‹Ÿåˆï¼ˆFit Currentï¼‰
- âœ… è‡ªåŠ¨æ‰¹é‡æ‹Ÿåˆï¼ˆAuto Fit / Enteré”®ï¼‰
- âœ… Pseudo-Voigt / Voigt å‡½æ•°é€‰æ‹©
- âœ… RÂ²è´¨é‡æ£€æŸ¥
- âœ… æ‹Ÿåˆå¤±è´¥æ—¶æš‚åœ

#### é«˜çº§åŠŸèƒ½
- âœ… Overlapæ¨¡å¼ï¼ˆå åŠ å¤šä¸ªæ–‡ä»¶å¯¹æ¯”ï¼‰
- âœ… æ‹Ÿåˆæ›²çº¿å¯è§†åŒ–
- âœ… èƒŒæ™¯æ‰£é™¤
- âœ… ç»“æœè‡ªåŠ¨ä¿å­˜

#### è¾“å‡ºåŠŸèƒ½
- âœ… ä¿å­˜æ‰€æœ‰ç»“æœåˆ°CSV
- âœ… æ–‡ä»¶é—´ç©ºè¡Œåˆ†éš”
- âœ… å®Œæ•´çš„æ‹Ÿåˆå‚æ•°å¯¼å‡º

---

## ä¸Auto Fittingæ¨¡å—çš„åŒºåˆ«

| ç‰¹æ€§ | Batch Fit (curvefit) | Auto Fit |
|------|----------------------|----------|
| æ¥æº | interactive_fitting_gui.py | auto_fitting_module_v2.py |
| ç•Œé¢é£æ ¼ | å·¦å³åˆ†æ ï¼Œæ–‡ä»¶åˆ—è¡¨ | å•å±ï¼Œæ§åˆ¶é¢æ¿å¼ |
| æ–‡ä»¶ç®¡ç† | æ–‡ä»¶åˆ—è¡¨å¯ç‚¹å‡»åˆ‡æ¢ | å‰åå¯¼èˆªæŒ‰é’® |
| æ·»åŠ å³°æ–¹å¼ | æ¨¡å¼åˆ‡æ¢ï¼ˆå³°/èƒŒæ™¯ï¼‰ | ç‚¹å‡»å›¾åƒç›´æ¥æ·»åŠ  |
| æ‰¹å¤„ç†æ¨¡å¼ | Auto Fitè‡ªåŠ¨è¿ç»­ | Verifyé€ä¸ªç¡®è®¤ |
| èƒŒæ™¯å¤„ç† | æ‰‹åŠ¨ç‚¹é€‰èƒŒæ™¯ç‚¹ | è‡ªåŠ¨/æ‰‹åŠ¨é€‰æ‹© |
| OverlapåŠŸèƒ½ | âœ“ æ”¯æŒå¤šæ–‡ä»¶å åŠ å¯¹æ¯” | âœ— ä¸æ”¯æŒ |
| æ‹Ÿåˆæ–¹æ³• | Pseudo-Voigt / Voigt | Pseudo-Voigt / Voigt |
| è¾“å‡ºæ ¼å¼ | batch_fitting_results.csv | batch_summary.csv |
| é€‚ç”¨åœºæ™¯ | éœ€è¦å¯¹æ¯”çš„æ‰¹å¤„ç† | å¸¸è§„æ‰¹å¤„ç† |

**ä¸¤ä¸ªæ¨¡å—å„æœ‰ä¼˜åŠ¿ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š**
- **Batch Fit**ï¼šé€‚åˆéœ€è¦æ–‡ä»¶å¯¹æ¯”ã€overlapåˆ†æçš„åœºæ™¯
- **Auto Fit**ï¼šé€‚åˆå¤§æ‰¹é‡å¿«é€Ÿå¤„ç†çš„åœºæ™¯

---

## æ–‡ä»¶æ¶æ„

```
main.py
â”œâ”€â”€ Mask
â”œâ”€â”€ Batch Int. (Powder)
â”œâ”€â”€ BCDI Cal.
â”œâ”€â”€ Dioptas
â”œâ”€â”€ Auto Fit
â”‚   â””â”€â”€ auto_fitting_module_v2.py (2449 lines)
â”‚       â”œâ”€â”€ å•æ–‡ä»¶äº¤äº’å¼æ‹Ÿåˆ
â”‚       â”œâ”€â”€ æ‰¹å¤„ç†åŠŸèƒ½
â”‚       â”œâ”€â”€ éªŒè¯å¯¹è¯æ¡†
â”‚       â””â”€â”€ CSVæ±‡æ€»
â”œâ”€â”€ Batch Fit â† NEW!
â”‚   â””â”€â”€ batch_fitting_module.py (38 lines, wrapper)
â”‚       â””â”€â”€ batch_fitting_dialog.py (1348 lines, æ ¸å¿ƒåŠŸèƒ½)
â”‚           â”œâ”€â”€ æ–‡ä»¶åˆ—è¡¨ç®¡ç†
â”‚           â”œâ”€â”€ äº¤äº’å¼å³°é€‰æ‹©
â”‚           â”œâ”€â”€ Overlapæ¨¡å¼
â”‚           â”œâ”€â”€ è‡ªåŠ¨æ‰¹é‡æ‹Ÿåˆ
â”‚           â””â”€â”€ CSVç»“æœå¯¼å‡º
â””â”€â”€ EOSfit

HIDDEN:
âœ— curvefit (interactive_fitting_gui.py)
  - ä»£ç ä¿ç•™
  - ä¾§è¾¹æ æŒ‰é’®éšè—
  - ä¸æ˜¾ç¤ºåœ¨ç•Œé¢
```

---

## ä½¿ç”¨æµç¨‹

### Batch Fitæ¨¡å—ä½¿ç”¨æ­¥éª¤

1. **å¯åŠ¨æ¨¡å—**
   - ç‚¹å‡»ä¾§è¾¹æ  "ğŸ“Š  Batch Fit"
   - ç›´æ¥æ˜¾ç¤ºbatchæ‰¹å¤„ç†ç•Œé¢

2. **åŠ è½½æ–‡ä»¶**
   - ç‚¹å‡» "ğŸ“ Load Folder"
   - é€‰æ‹©åŒ…å«.xyæ–‡ä»¶çš„æ–‡ä»¶å¤¹
   - æ–‡ä»¶åˆ—è¡¨è‡ªåŠ¨å¡«å……

3. **æ‰‹åŠ¨è°ƒæ•´ç¬¬ä¸€ä¸ªæ–‡ä»¶**
   - è‡ªåŠ¨æ£€æµ‹å³°ä¼šé¢„å…ˆæ ‡è®°
   - æ¨¡å¼é€‰æ‹©ï¼šğŸ”´ Peak æˆ– ğŸ”µ Background
   - å·¦é”®ç‚¹å‡»æ·»åŠ å³°/èƒŒæ™¯ç‚¹
   - å³é”®ç‚¹å‡»åˆ é™¤å³°/èƒŒæ™¯ç‚¹
   - æ»šè½®ç¼©æ”¾å›¾åƒ

4. **æ‹Ÿåˆå½“å‰æ–‡ä»¶**
   - ç‚¹å‡» "âœ¨ Fit Current" æˆ–æŒ‰ç©ºæ ¼é”®
   - æŸ¥çœ‹æ‹Ÿåˆç»“æœå’ŒRÂ²å€¼

5. **è‡ªåŠ¨æ‰¹é‡å¤„ç†**
   - ç‚¹å‡» "âš¡ Auto Fit (Enter)" æˆ–æŒ‰å›è½¦é”®
   - ä½¿ç”¨å½“å‰æ–‡ä»¶çš„å³°é…ç½®
   - è‡ªåŠ¨å¤„ç†å‰©ä½™æ‰€æœ‰æ–‡ä»¶
   - å¦‚RÂ²ä½äºé˜ˆå€¼ä¼šæš‚åœè®©ç”¨æˆ·è°ƒæ•´

6. **ä¿å­˜ç»“æœ**
   - ç‚¹å‡» "ğŸ’¾ Save All Results"
   - ä¿å­˜åˆ°æ–‡ä»¶å¤¹/fit_output/batch_fitting_results.csv
   - æ–‡ä»¶é—´ç”¨ç©ºè¡Œåˆ†éš”

### Overlapæ¨¡å¼ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰

1. ç‚¹å‡» "ğŸ“Š Overlap (O)" æˆ–æŒ‰Oé”®
2. å½“å‰æ–‡ä»¶æ·»åŠ åˆ°overlay
3. åˆ‡æ¢åˆ°å…¶ä»–æ–‡ä»¶ç»§ç»­æ·»åŠ 
4. å¤šä¸ªæ–‡ä»¶å åŠ æ˜¾ç¤ºåœ¨åŒä¸€å›¾ä¸Š
5. æ–¹ä¾¿å¯¹æ¯”ä¸åŒæ ·å“çš„å³°ä½ç½®
6. å¯å¯¹æ‰€æœ‰overlappedæ–‡ä»¶æ‰¹é‡æ‹Ÿåˆ

---

## å¿«æ·é”®

| æŒ‰é”® | åŠŸèƒ½ |
|------|------|
| Enter | å¼€å§‹è‡ªåŠ¨æ‰¹é‡æ‹Ÿåˆ |
| Space | æ‹Ÿåˆå½“å‰æ–‡ä»¶ |
| â† | ä¸Šä¸€ä¸ªæ–‡ä»¶ |
| â†’ | ä¸‹ä¸€ä¸ªæ–‡ä»¶ |
| A | è‡ªåŠ¨æ£€æµ‹å³° |
| C | æ¸…é™¤æ‰€æœ‰æ ‡è®° |
| P | åˆ‡æ¢åˆ°å³°æ¨¡å¼ |
| B | åˆ‡æ¢åˆ°èƒŒæ™¯æ¨¡å¼ |
| R | é‡ç½®ç¼©æ”¾ |
| O | åˆ‡æ¢Overlapæ¨¡å¼ |

---

## æ‰¹å¤„ç†å·¥ä½œæµç¨‹

### åœºæ™¯1ï¼šæ ‡å‡†æ‰¹å¤„ç†ï¼ˆä½¿ç”¨Auto Fitï¼‰

**é€‚ç”¨ï¼š** 100ä¸ªç›¸ä¼¼æ ·å“ï¼Œå¿«é€Ÿæ‰¹å¤„ç†

**æ­¥éª¤ï¼š**
1. ç‚¹å‡» "ğŸ”  Auto Fit"
2. ç‚¹å‡» "Batch Auto Fit"
3. å‹¾é€‰ "Verify each file"ï¼ˆå¯é€‰ï¼‰
4. è‡ªåŠ¨å¤„ç†æ‰€æœ‰æ–‡ä»¶
5. ç”Ÿæˆ `batch_summary.csv`

**ç‰¹ç‚¹ï¼š**
- å¿«é€Ÿé«˜æ•ˆ
- è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜
- é€‚åˆå¤§æ‰¹é‡

---

### åœºæ™¯2ï¼šå¯¹æ¯”æ‰¹å¤„ç†ï¼ˆä½¿ç”¨Batch Fitï¼‰

**é€‚ç”¨ï¼š** éœ€è¦å¯¹æ¯”ä¸åŒæ ·å“çš„å³°ä½ç§»åŠ¨

**æ­¥éª¤ï¼š**
1. ç‚¹å‡» "ğŸ“Š  Batch Fit"
2. åŠ è½½æ–‡ä»¶å¤¹
3. è°ƒæ•´ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„å³°
4. å¼€å¯Overlapæ¨¡å¼
5. åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªæ–‡ä»¶ï¼ˆç¬¬ä¸€ä¸ªä¿ç•™åœ¨èƒŒæ™¯ï¼‰
6. ç»§ç»­æ·»åŠ æ–‡ä»¶åˆ°overlay
7. è§†è§‰å¯¹æ¯”å³°çš„ä½ç½®å˜åŒ–
8. ä¸€é”®æ‹Ÿåˆæ‰€æœ‰overlappedæ–‡ä»¶
9. ä¿å­˜ç»“æœ

**ç‰¹ç‚¹ï¼š**
- å¯è§†åŒ–å¯¹æ¯”
- çµæ´»æ‰‹åŠ¨æ§åˆ¶
- é€‚åˆç²¾ç»†åˆ†æ

---

## æŠ€æœ¯ç»†èŠ‚

### BatchFittingDialogæ ¸å¿ƒåŠŸèƒ½

**æ¥è‡ª batch_fitting_dialog.py:**

1. **æ–‡ä»¶ç®¡ç†**
   - `load_folder()` - åŠ è½½æ–‡ä»¶å¤¹
   - `load_current_file()` - åŠ è½½å½“å‰æ–‡ä»¶
   - `go_previous()` / `go_next()` - å¯¼èˆª

2. **äº¤äº’å¼ç¼–è¾‘**
   - `on_plot_click()` - ç‚¹å‡»æ·»åŠ /åˆ é™¤
   - `snap_to_nearest_peak()` - è‡ªåŠ¨å¸é™„åˆ°å³°
   - `auto_detect_peaks()` - è‡ªåŠ¨æ£€æµ‹

3. **æ‹ŸåˆåŠŸèƒ½**
   - `fit_current()` - å•æ–‡ä»¶æ‹Ÿåˆ
   - `start_auto_fitting()` - å¼€å§‹æ‰¹é‡
   - `continue_auto_fitting()` - ç»§ç»­æ‰¹é‡
   - `fit_all_overlapped()` - æ‹Ÿåˆoverlappedæ–‡ä»¶

4. **Overlapæ¨¡å¼**
   - `toggle_overlap_mode()` - åˆ‡æ¢æ¨¡å¼
   - `add_to_overlay()` - æ·»åŠ æ–‡ä»¶
   - `clear_overlap()` - æ¸…é™¤overlay

5. **ç»“æœä¿å­˜**
   - `save_all_results()` - ä¿å­˜CSV
   - æ ¼å¼ï¼šFile, Peak, Center, FWHM, Area, Intensity, R_squared
   - æ–‡ä»¶é—´ç©ºè¡Œåˆ†éš”

### æ‹Ÿåˆå‡½æ•°æ”¯æŒ

```python
def voigt(x, amplitude, center, sigma, gamma):
    """Voigt profile"""
    ...

def pseudo_voigt(x, amplitude, center, sigma, gamma, eta):
    """Pseudo-Voigt profile"""
    ...
```

---

## æ–‡ä»¶æ¸…å•

### å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `batch_fitting_module.py` | 38è¡Œ | æ–°æ¨¡å—åŒ…è£…å™¨ |
| `batch_fitting_dialog.py` | 1348è¡Œ | æ ¸å¿ƒæ‰¹å¤„ç†åŠŸèƒ½ |
| `main.py` | 31KB | ä¸»ç¨‹åºï¼ˆå·²æ›´æ–°ï¼‰ |
| `interactive_fitting_gui.py` | 2560è¡Œ | curvefitï¼ˆå·²éšè—ï¼‰ |

### æ–‡æ¡£

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `æ¨¡å—åˆ†ç¦»è¯´æ˜_æ­£ç¡®ç‰ˆ.md` | æœ¬æ–‡æ¡£ |
| `æ¨¡å—é‡ç»„å®Œæˆæ€»ç»“_æ­£ç¡®ç‰ˆ.txt` | æ€»ç»“æŠ¥å‘Š |

---

## æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] å¯åŠ¨main.py
- [ ] ä¾§è¾¹æ æ˜¾ç¤º "ğŸ“Š  Batch Fit"
- [ ] ä¾§è¾¹æ ä¸æ˜¾ç¤º "ğŸ“ˆ  curvefit"
- [ ] ç‚¹å‡»Batch Fitæ˜¾ç¤ºæ‰¹å¤„ç†ç•Œé¢
- [ ] ç•Œé¢åŒ…å«æ–‡ä»¶åˆ—è¡¨å’Œç»˜å›¾åŒºåŸŸ

### BatchåŠŸèƒ½æµ‹è¯•
- [ ] ç‚¹å‡»"ğŸ“ Load Folder"åŠ è½½æ–‡ä»¶å¤¹
- [ ] æ–‡ä»¶åˆ—è¡¨å¡«å……æ­£ç¡®
- [ ] ç‚¹å‡»æ–‡ä»¶å¯åˆ‡æ¢
- [ ] è‡ªåŠ¨æ£€æµ‹å³°åŠŸèƒ½æ­£å¸¸
- [ ] å·¦é”®æ·»åŠ å³°/èƒŒæ™¯ç‚¹
- [ ] å³é”®åˆ é™¤å³°/èƒŒæ™¯ç‚¹
- [ ] æ¨¡å¼åˆ‡æ¢æ­£å¸¸ï¼ˆå³°/èƒŒæ™¯ï¼‰
- [ ] Fit Currentæ‹Ÿåˆå½“å‰æ–‡ä»¶
- [ ] Auto Fitè‡ªåŠ¨æ‰¹é‡å¤„ç†
- [ ] RÂ²æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- [ ] Save All Resultsä¿å­˜CSV

### OverlapåŠŸèƒ½æµ‹è¯•
- [ ] ç‚¹å‡»OverlapæŒ‰é’®
- [ ] å½“å‰æ–‡ä»¶æ·»åŠ åˆ°overlay
- [ ] åˆ‡æ¢æ–‡ä»¶å¯çœ‹åˆ°overlappedæ•°æ®
- [ ] å¤šä¸ªæ–‡ä»¶å åŠ æ˜¾ç¤º
- [ ] æ‹Ÿåˆoverlappedæ–‡ä»¶
- [ ] Clear Overlayæ¸…é™¤

### å¿«æ·é”®æµ‹è¯•
- [ ] Enteré”®å¼€å§‹Auto Fit
- [ ] Spaceé”®æ‹Ÿåˆå½“å‰
- [ ] å·¦å³ç®­å¤´å¯¼èˆª
- [ ] Aé”®è‡ªåŠ¨æ£€æµ‹
- [ ] Cé”®æ¸…é™¤
- [ ] P/Bé”®åˆ‡æ¢æ¨¡å¼
- [ ] Ré”®é‡ç½®ç¼©æ”¾
- [ ] Oé”®åˆ‡æ¢Overlap

---

## ä¼˜åŠ¿å¯¹æ¯”

### Batch Fitæ¨¡å—çš„ç‹¬ç‰¹ä¼˜åŠ¿

1. **å¯è§†åŒ–å¯¹æ¯”**
   - Overlapæ¨¡å¼å¯åŒæ—¶æ˜¾ç¤ºå¤šä¸ªæ–‡ä»¶
   - ç›´è§‚çœ‹åˆ°å³°çš„ä½ç§»
   - é€‚åˆç³»åˆ—æ ·å“åˆ†æ

2. **çµæ´»æ§åˆ¶**
   - æ¯ä¸ªæ–‡ä»¶å¯ç‹¬ç«‹è°ƒæ•´
   - ç‚¹å‡»æ–‡ä»¶åˆ—è¡¨å¿«é€Ÿè·³è½¬
   - ä¸å¿…é¡ºåºå¤„ç†

3. **è´¨é‡æ§åˆ¶**
   - RÂ²è‡ªåŠ¨æ£€æŸ¥
   - æ‹Ÿåˆå¤±è´¥æ—¶æš‚åœ
   - å¯æ‰‹åŠ¨è°ƒæ•´åç»§ç»­

4. **ç•Œé¢å‹å¥½**
   - å·¦å³åˆ†æ ï¼Œæ¸…æ™°å¸ƒå±€
   - æ–‡ä»¶è¿›åº¦ä¸€ç›®äº†ç„¶
   - æ“ä½œæç¤ºé½å…¨

---

## ä¸åŸcurvefitçš„å…³ç³»

### åŸæœ‰æ¶æ„
```
curvefit (interactive_fitting_gui.py)
â”œâ”€â”€ å•æ–‡ä»¶äº¤äº’å¼æ‹Ÿåˆï¼ˆä¸»åŠŸèƒ½ï¼‰
â”œâ”€â”€ å‚æ•°è°ƒæ•´æ»‘å—
â”œâ”€â”€ è¡¨æ ¼æ˜¾ç¤ºç»“æœ
â””â”€â”€ [BatchæŒ‰é’®] â†’ BatchFittingDialog
                  â””â”€â”€ æ‰¹å¤„ç†åŠŸèƒ½
```

### ç°åœ¨æ¶æ„
```
Batch Fit (batch_fitting_module.py)
â””â”€â”€ BatchFittingDialog (ç›´æ¥åµŒå…¥)
    â””â”€â”€ å®Œæ•´æ‰¹å¤„ç†ç•Œé¢

curvefit (éšè—)
â”œâ”€â”€ interactive_fitting_gui.py (ä¿ç•™)
â””â”€â”€ ä¸åœ¨ä¾§è¾¹æ æ˜¾ç¤º
```

**å˜åŒ–ï¼š**
- BatchåŠŸèƒ½ä»curvefitä¸­æå–
- ç‹¬ç«‹æˆä¸ºBatch Fitæ¨¡å—
- curvefitæ•´ä½“éšè—

---

## æ¢å¤curvefitçš„æ–¹æ³•

å¦‚éœ€æ¢å¤curvefitæ¨¡å—åˆ°ä¾§è¾¹æ ï¼š

1. åœ¨ `main.py` ä¸­æ‰¾åˆ° line ~161-162
2. å–æ¶ˆæ³¨é‡Šï¼š
   ```python
   self.curvefit_btn = self.create_sidebar_button("ğŸ“ˆ  curvefit", self.open_curvefit, is_active=False)
   sidebar_layout.addWidget(self.curvefit_btn)
   ```
3. åœ¨ `update_sidebar_buttons` ä¸­æ‰¾åˆ° line ~357
4. å–æ¶ˆæ³¨é‡Šï¼š
   ```python
   "curvefit": self.curvefit_btn,
   ```
5. ä¿å­˜å¹¶è¿è¡Œ

---

## åç»­ä¼˜åŒ–å»ºè®®

1. **ç»Ÿä¸€è¾“å‡ºæ ¼å¼**
   - Batch Fitå’ŒAuto Fitçš„CSVæ ¼å¼å¯¹é½
   - éƒ½ä½¿ç”¨batch_summary.csvä½œä¸ºæ–‡ä»¶å

2. **çŠ¶æ€åŒæ­¥**
   - è€ƒè™‘åœ¨ä¸¤ä¸ªbatchæ¨¡å—é—´å…±äº«é…ç½®
   - ç»Ÿä¸€çš„æ‰¹å¤„ç†è®¾ç½®

3. **UIä¸€è‡´æ€§**
   - ç»Ÿä¸€æŒ‰é’®é¢œè‰²æ–¹æ¡ˆ
   - ç»Ÿä¸€å­—ä½“å¤§å°

4. **åŠŸèƒ½äº’è¡¥**
   - Auto Fitæ·»åŠ OverlapåŠŸèƒ½
   - Batch Fitæ·»åŠ éªŒè¯å¯¹è¯æ¡†

ä½†å½“å‰ç‰ˆæœ¬å·²æ»¡è¶³éœ€æ±‚
ä¸¤ä¸ªæ¨¡å—ä¿æŒç‹¬ç«‹æ›´çµæ´»

---

**ç‰ˆæœ¬ï¼š** Module Reorganization v1.0 (Corrected)
**æ›´æ–°æ—¥æœŸï¼š** 2025-12-03
**çŠ¶æ€ï¼š** âœ… å®Œæˆå¹¶é€šè¿‡ç¼–è¯‘æ£€æŸ¥
**ä¾èµ–ï¼š** batch_fitting_dialog.py, auto_fitting_module_v2.py (v2.7)
